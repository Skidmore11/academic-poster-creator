<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Poster Creator - AI-Powered Research Poster Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <style>
        /* Modern Design System */
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary-color: #7c3aed;
            --accent-color: #06b6d4;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-light: #9ca3af;
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-dark: #111827;
            --border-color: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow-x: hidden;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
        }
        
        body {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.9) 0%, rgba(118, 75, 162, 0.9) 100%),
                        url('/static/your-background-image.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            min-height: 100vh;
        }

        /* Modern Landing Page */
        .landing-page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .landing-hero {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem 1rem;
            position: relative;
            z-index: 2;
        }

        .hero-content {
            max-width: 1200px;
            width: 100%;
            text-align: center;
            color: white;
        }

        .hero-logo {
            margin-bottom: 2rem;
            display: flex;
            justify-content: center;
        }

        .hero-logo-image {
            height: 320px;
            width: auto;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }

        @media (max-width: 768px) {
            .hero-logo-image {
                height: 240px;
            }
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 1rem 2rem;
            margin-bottom: 2rem;
            font-size: 0.9rem;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
            box-shadow: var(--shadow-md);
        }

        .hero-badge i {
            margin-right: 0.5rem;
            color: #10b981;
        }

        .hero-title {
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 900;
            margin-bottom: 1.5rem;
            line-height: 1.1;
            background: linear-gradient(135deg, #ffffff 0%, #e0e7ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-subtitle {
            font-size: clamp(1.1rem, 2.5vw, 1.4rem);
            font-weight: 400;
            margin-bottom: 3rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
        }

        .hero-cta {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 4rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 1rem 2.5rem;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
            color: white;
            text-decoration: none;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 1rem 2.5rem;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            color: white;
            text-decoration: none;
        }

        /* Features Section */
        .features-section {
            display: flex;
            justify-content: center;
            padding: 0 2rem;
            margin-top: -20px;
            margin-bottom: 4rem;
        }

        .features-container {
            background: var(--bg-primary);
            padding: 5rem 2rem;
            position: relative;
            border-radius: 40px;
            box-shadow: var(--shadow-xl);
            max-width: 1200px;
            width: 100%;
        }

        .section-header {
            text-align: center;
            margin-bottom: 4rem;
        }

        .section-title {
            font-size: clamp(2rem, 4vw, 3rem);
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .section-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .feature-card {
            background: var(--bg-secondary);
            border-radius: 24px;
            padding: 3rem 2rem;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 24px 24px 0 0;
        }

        .feature-card:hover {
            transform: translateY(-12px) scale(1.02);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-color);
        }

        .feature-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-size: 2rem;
            color: white;
            box-shadow: var(--shadow-lg);
        }

        .feature-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .feature-description {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* How It Works Section */
        .how-it-works {
            display: flex;
            justify-content: center;
            padding: 0 2rem;
            margin-top: 4rem;
            margin-bottom: 4rem;
        }

        .steps-container {
            background: var(--bg-secondary);
            padding: 5rem 2rem;
            border-radius: 40px;
            box-shadow: var(--shadow-xl);
            max-width: 1000px;
            width: 100%;
        }

        .steps-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
            margin-top: 3rem;
        }

        @media (max-width: 768px) {
            .steps-grid {
                grid-template-columns: 1fr;
            }
        }

        .step-card {
            background: var(--bg-primary);
            border-radius: 24px;
            padding: 2.5rem 2rem;
            text-align: center;
            position: relative;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .step-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-color);
        }

        .step-number {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            box-shadow: var(--shadow-lg);
        }

        .step-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .step-description {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Stats Section */
        .stats-section {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            padding: 4rem 2rem;
            color: white;
            border-radius: 40px;
            margin: 4rem auto;
            max-width: 1200px;
            box-shadow: var(--shadow-xl);
        }

        .stats-container {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.2rem;
            margin-top: 3rem;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 1.2rem;
            }
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            line-height: 1.3;
            opacity: 0.9;
            font-weight: 500;
        }

        /* Template Showcase Section */
        .template-showcase {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 40px;
            padding: 3rem 2rem;
            margin: 4rem auto;
            max-width: 1400px;
            position: relative;
            overflow: hidden;
        }

        .showcase-header {
            text-align: center;
            margin-bottom: 3rem;
            color: white;
        }

        .showcase-title {
            font-size: clamp(1.8rem, 3vw, 2.5rem);
            font-weight: 800;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #ffffff 0%, #e0e7ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .showcase-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .template-scroll-container {
            position: relative;
            overflow: hidden;
            padding: 1rem 0;
        }

        .template-scroll-track {
            display: flex;
            gap: 2rem;
            animation: scrollTemplates 60s linear infinite;
            width: max-content;
        }



        @keyframes scrollTemplates {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(-50%);
            }
        }

        .template-preview-card {
            background: transparent;
            border: none;
            border-radius: 12px;
            padding: 0;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            width: 200px;
            height: 280px;
        }

        .template-preview-image {
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            position: relative;
            overflow: hidden;
            border-radius: 12px;
        }

        .template-preview-image img {
            width: 102%;
            height: 102%;
            object-fit: contain;
            display: block;
            margin: 2% auto;
            /* Add a subtle shadow for depth */
            box-shadow: 0 4px 16px rgba(0,0,0,0.12), 0 1.5px 4px rgba(0,0,0,0.10);
        }

        .template-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .template-badge.premium {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #92400e;
        }

        .template-badge.new {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        /* Scroll Indicators */
        .scroll-indicator {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .scroll-indicator:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-50%) scale(1.1);
        }

        .scroll-left {
            left: 1rem;
        }

        .scroll-right {
            right: 1rem;
        }

        /* FAQ Section */
        .faq-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 40px;
            padding: 4rem 2rem;
            margin: 4rem auto;
            max-width: 1000px;
            position: relative;
            overflow: hidden;
        }

        .faq-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .faq-header {
            text-align: center;
            margin-bottom: 3rem;
            color: white;
        }

        .faq-title {
            font-size: clamp(2rem, 4vw, 2.5rem);
            font-weight: 800;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #ffffff 0%, #e0e7ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .faq-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .faq-list {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .faq-item {
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
        }

        .faq-item:last-child {
            border-bottom: none;
        }

        .faq-question {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: white;
            font-size: 1.1rem;
        }

        .faq-question:hover {
            color: #e0e7ff;
        }

        .faq-question.active {
            color: #e0e7ff;
            font-weight: 600;
        }

        .faq-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #e0e7ff;
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .faq-question.active .faq-icon {
            transform: rotate(45deg);
        }

        .faq-answer {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            margin: 0 0 0.5rem 0;
        }

        .faq-answer.active {
            max-height: 300px;
            padding: 1.5rem;
            margin: 0 0 0.5rem 0;
        }

        .faq-answer-content {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
            font-size: 1rem;
        }

        .feedback-link {
            color: #10b981;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
        }

        .feedback-link:hover {
            color: #059669;
            text-decoration: underline;
        }

        /* Footer */
        .footer {
            background: var(--bg-dark);
            color: white;
            padding: 3rem 2rem;
            text-align: center;
            border-radius: 40px 40px 0 0;
            margin-top: 4rem;
            margin-bottom: 0;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-text {
            opacity: 0.8;
            margin-bottom: 1rem;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .footer-link {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-link:hover {
            color: white;
        }

        /* Smooth Scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Remove default margins */
        body {
            margin: 0;
            padding: 0;
        }

        html {
            margin: 0;
            padding: 0;
        }

        /* Navigation */
        .nav-back {
            position: fixed;
            top: 2rem;
            left: 2rem;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 1rem 2rem;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            display: none;
            box-shadow: var(--shadow-md);
        }

        .nav-back:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            color: white;
            text-decoration: none;
        }

        .nav-back.show {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .hero-cta {
                flex-direction: column;
                align-items: center;
            }

            .btn-primary,
            .btn-secondary {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }

            .features-grid,
            .steps-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 2rem;
            }

            .footer-links {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-back {
                top: 1rem;
                left: 1rem;
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
        }

        /* Poster Creation Page */
        .poster-creation-page {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.9) 0%, rgba(118, 75, 162, 0.9) 100%),
                        url('/static/your-background-image.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            min-height: 100vh;
            padding: 2rem 1rem;
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .content-card {
            background: var(--bg-primary);
            border-radius: 32px;
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }

        .content-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .content-body {
            padding: 2rem;
        }

        /* Page Header */
        .page-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 3rem 2rem;
            margin-bottom: 2rem;
            border-radius: 32px;
            text-align: center;
            box-shadow: var(--shadow-xl);
        }

        .page-title {
            font-size: clamp(2rem, 4vw, 3rem);
            font-weight: 800;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #ffffff 0%, #e0e7ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Form Styles */
        .form-section {
            background: var(--bg-secondary);
            border-radius: 24px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
        }

        .form-section:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
            border-color: var(--primary-color);
        }

        /* Enhanced hover effects for poster creation form sections */
        .poster-creation-page .form-section {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .poster-creation-page .form-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 0 4px 4px 0;
            transition: all 0.3s ease;
        }

        .poster-creation-page .form-section:hover::before {
            width: 6px;
        }

        .poster-creation-page .upload-area:hover {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 1) 100%);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .form-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 0 4px 4px 0;
        }

        .form-section h5 {
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .form-section h5 i {
            margin-right: 0.75rem;
            color: var(--primary-color);
            font-size: 1.2rem;
        }

        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 24px;
            padding: 3rem 2rem;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: var(--bg-primary);
            margin: 1rem 0;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .upload-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.05), rgba(124, 58, 237, 0.05));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .upload-area:hover {
            border-color: var(--primary-color);
            background: var(--bg-secondary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .upload-area:hover::before {
            opacity: 1;
        }

        .upload-area.dragover {
            border-color: var(--primary-color);
            background: var(--bg-secondary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .upload-area.dragover::before {
            opacity: 1;
        }

        .file-input {
            display: none;
        }

        .btn-upload {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            border: none;
            color: white;
            padding: 1rem 2rem;
            border-radius: 16px;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .btn-upload::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-upload:hover::before {
            left: 100%;
        }

        .btn-upload:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            color: white;
        }

        .btn-process {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            border: none;
            color: white;
            padding: 1.5rem 3rem;
            border-radius: 20px;
            font-weight: 700;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 1rem;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .btn-process::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-process:hover::before {
            left: 100%;
        }

        .btn-process:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-xl);
            color: white;
        }

        .btn-process:disabled {
            background: var(--text-light);
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
        }

        /* Loading Animation */
        .loading-overlay {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            background: rgba(0, 0, 0, 0.7) !important;
            backdrop-filter: blur(5px);
            z-index: 999999 !important;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px !important;
            box-sizing: border-box !important;
            opacity: 0;
            transition: opacity 0.3s ease;
            overflow-y: auto;
            /* Ensure it covers the entire viewport regardless of scroll */
            transform: translateZ(0);
        }

        .loading-overlay.show {
            opacity: 1;
        }

        .loading-content {
            background: white;
            border-radius: 25px;
            padding: 2rem;
            text-align: center;
            max-width: 900px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
            transition: all 0.5s ease;
            position: relative;
            /* Center content */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transform: scale(0.9);
            opacity: 0;
            margin: 20px;
        }

        .loading-overlay.show .loading-content {
            transform: scale(1);
            opacity: 1;
        }
        
        .loading-content.expanded {
            max-width: 1200px;
            width: 98%;
            text-align: center;
            max-height: 95vh;
        }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 768px) {
            .loading-content {
                max-width: 95%;
                padding: 1.5rem;
                max-height: 95vh;
                margin: 10px;
            }
            
            .loading-overlay {
                padding: 10px !important;
            }
        }

        @media (max-height: 600px) {
            .loading-content {
                max-height: 98vh;
                padding: 1rem;
                margin: 5px;
            }
        }
        
        .loading-content.expanded .row {
            width: 100%;
            margin: 0;
        }
        
        .loading-content.expanded .col-md-4,
        .loading-content.expanded .col-md-8 {
            padding: 0 1rem;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 8px solid #f3f3f3;
            border-top: 8px solid #4facfe;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 2rem;
            transition: all 0.5s ease;
            box-shadow: 0 0 20px rgba(79, 172, 254, 0.3);
        }

        .loading-spinner.completed {
            border: 8px solid #28a745;
            border-top: 8px solid #28a745;
            animation: none;
            background: #28a745;
            position: relative;
            box-shadow: 0 0 20px rgba(40, 167, 69, 0.4);
            transform: scale(1.1);
        }

        .loading-spinner.completed::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 2.5rem;
            font-weight: bold;
            animation: checkmarkPulse 0.5s ease-out;
        }
        
        @keyframes checkmarkPulse {
            0% { transform: translate(-50%, -50%) scale(0); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-steps {
            text-align: left;
            margin-top: 1rem;
            padding-right: 10px;
        }

        .loading-step {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            opacity: 0.5;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            padding: 0.4rem;
            border-radius: 8px;
            background: rgba(79, 172, 254, 0.05);
        }

        .loading-step.active {
            opacity: 1;
            color: #4facfe;
            background: rgba(79, 172, 254, 0.1);
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(79, 172, 254, 0.2);
        }

        .loading-step.completed {
            opacity: 1;
            color: #28a745;
            background: rgba(40, 167, 69, 0.1);
            transform: translateX(5px);
        }

        .loading-step i {
            margin-right: 1rem;
            width: 20px;
            font-size: 1rem;
        }

        /* AI Provider Indicator */
        .ai-provider-indicator {
            margin: 1.5rem 0;
            text-align: center;
        }

        .ai-provider-badge {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-weight: 600;
            font-size: 1rem;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            animation: pulse-glow 2s infinite;
        }

        .ai-provider-badge.openai {
            background: linear-gradient(135deg, #10a37f 0%, #0d8a6f 100%);
            box-shadow: 0 4px 12px rgba(16, 163, 127, 0.3);
        }

        .ai-provider-badge.anthropic {
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
            box-shadow: 0 4px 12px rgba(217, 119, 6, 0.3);
        }

        @keyframes pulse-glow {
            0% { box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); }
            50% { box-shadow: 0 4px 20px rgba(102, 126, 234, 0.5); }
            100% { box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); }
        }

        .ai-provider-badge.openai {
            animation: pulse-glow-openai 2s infinite;
        }

        .ai-provider-badge.anthropic {
            animation: pulse-glow-anthropic 2s infinite;
        }

        @keyframes pulse-glow-openai {
            0% { box-shadow: 0 4px 12px rgba(16, 163, 127, 0.3); }
            50% { box-shadow: 0 4px 20px rgba(16, 163, 127, 0.5); }
            100% { box-shadow: 0 4px 12px rgba(16, 163, 127, 0.3); }
        }

        @keyframes pulse-glow-anthropic {
            0% { box-shadow: 0 4px 12px rgba(217, 119, 6, 0.3); }
            50% { box-shadow: 0 4px 20px rgba(217, 119, 6, 0.5); }
            100% { box-shadow: 0 4px 12px rgba(217, 119, 6, 0.3); }
        }

        /* Sleek AI Provider Section */
        .ai-provider-section {
            margin: 2rem 0;
            padding: 1.5rem;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.95) 100%);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .ai-provider-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            border-radius: 20px 20px 0 0;
        }

        .ai-provider-header {
            margin-bottom: 1.5rem;
        }

        .ai-provider-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .ai-provider-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .ai-provider-text h6 {
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 0.25rem;
        }

        .ai-provider-toggle-container {
            margin-bottom: 1rem;
        }

        .ai-provider-toggle {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            position: relative;
        }

        .ai-provider-radio {
            display: none;
        }

        .ai-provider-option {
            position: relative;
            padding: 1.25rem;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.9) 100%);
            border: 2px solid rgba(102, 126, 234, 0.1);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 1rem;
            overflow: hidden;
        }

        .ai-provider-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .ai-provider-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .ai-provider-option:hover::before {
            opacity: 1;
        }

        .ai-provider-option-icon {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
        }

        .openai-option .ai-provider-option-icon {
            background: linear-gradient(135deg, #10a37f 0%, #0d8a6f 100%);
            box-shadow: 0 4px 15px rgba(16, 163, 127, 0.3);
        }

        .anthropic-option .ai-provider-option-icon {
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
            box-shadow: 0 4px 15px rgba(217, 119, 6, 0.3);
        }

        .ai-provider-option-text {
            flex: 1;
            position: relative;
            z-index: 1;
        }

        .ai-provider-name {
            display: block;
            font-weight: 700;
            font-size: 1.1rem;
            color: #2c3e50;
            margin-bottom: 0.25rem;
        }

        .ai-provider-model {
            display: block;
            font-size: 0.85rem;
            color: #6c757d;
            font-weight: 500;
        }

        .ai-provider-option-indicator {
            width: 24px;
            height: 24px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 50%;
            position: relative;
            transition: all 0.3s ease;
        }

        .ai-provider-option-indicator::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            width: 12px;
            height: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Selected state */
        .ai-provider-radio:checked + .ai-provider-option {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .ai-provider-radio:checked + .ai-provider-option::before {
            opacity: 1;
        }

        .ai-provider-radio:checked + .ai-provider-option .ai-provider-option-icon {
            transform: scale(1.1);
        }

        .ai-provider-radio:checked + .ai-provider-option .ai-provider-option-indicator {
            border-color: #667eea;
        }

        .ai-provider-radio:checked + .ai-provider-option .ai-provider-option-indicator::after {
            transform: translate(-50%, -50%) scale(1);
        }

        /* Disabled state */
        .ai-provider-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .ai-provider-option.disabled:hover {
            transform: none;
            box-shadow: none;
        }

        .ai-provider-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 193, 7, 0.05) 100%);
            border-radius: 12px;
            border-left: 4px solid #ffc107;
            font-size: 0.9rem;
            color: #856404;
        }

        .ai-provider-info i {
            color: #ffc107;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .ai-provider-toggle {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            
            .ai-provider-option {
                padding: 1rem;
            }
            
            .ai-provider-icon {
                width: 40px;
                height: 40px;
                font-size: 1.25rem;
            }
        }

        .progress-container {
            margin: 2rem 0;
        }

        .progress {
            height: 12px;
            border-radius: 6px;
            background: #e9ecef;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 6px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: progressShine 2s infinite;
        }
        
        @keyframes progressShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* Template Selection - Sleek Design */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .template-card {
            background: transparent;
            border: none;
            border-radius: 12px;
            padding: 0;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            min-height: 220px;
            max-height: 350px;
        }

        .template-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }

        .template-card.selected {
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.3), 0 8px 30px rgba(40, 167, 69, 0.2);
        }

        .template-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .template-card.disabled:hover {
            transform: none;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .template-card.coming-soon {
            opacity: 0.6;
            cursor: not-allowed;
            pointer-events: none;
        }

        .template-card.coming-soon:hover {
            transform: none;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .template-preview {
            width: 100%;
            flex: 1;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            position: relative;
            overflow: hidden;
            border-radius: 12px;
            min-height: 160px;
        }

        .template-preview img {
            width: 100%;
            height: auto;
            max-height: 240px;
            object-fit: contain;
            transition: transform 0.3s ease;
        }

        .template-card:hover .template-preview img {
            transform: scale(1.02);
        }

        .template-preview .placeholder-icon {
            font-size: 4rem;
            color: #6c757d;
        }

        .template-info {
            padding: 0.75rem 0;
            background: transparent;
        }





        .template-buttons {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
            display: none;
            align-items: center;
            justify-content: center;
        }



        .template-buttons {
            border-radius: 0 0 12px 12px;
            z-index: 15;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .template-card:hover .template-buttons {
            display: flex;
            opacity: 1;
            transition-delay: 1.5s;
        }

        .template-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0.25rem;
            line-height: 1.3;
        }

        .template-subtitle {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 0.25rem;
        }

        .template-meta {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            font-size: 0.8rem;
            color: #6c757d;
        }

        .template-card .checkmark {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #28a745;
            color: white;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            z-index: 20;
            box-shadow: 0 3px 10px rgba(40, 167, 69, 0.4);
        }

        .template-card.selected .checkmark {
            display: flex;
        }

        .premium-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #8b4513;
            border-radius: 20px;
            padding: 8px;
            font-size: 0.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 3px 12px rgba(255, 215, 0, 0.4);
            z-index: 20;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            overflow: hidden;
            white-space: nowrap;
        }

        .premium-badge i {
            font-size: 0.8rem;
            flex-shrink: 0;
        }

        .premium-badge .premium-text {
            max-width: 0;
            overflow: hidden;
            transition: max-width 0.3s ease;
        }

        .template-card:hover .premium-badge {
            padding: 8px 16px;
        }

        .template-card:hover .premium-badge .premium-text {
            max-width: 100px;
        }

        .coming-soon-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 0.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 3px 12px rgba(108, 117, 125, 0.4);
            z-index: 20;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .coming-soon-badge i {
            font-size: 0.8rem;
        }

        .template-type-indicator {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 15px;
            padding: 6px 12px;
            font-size: 0.75rem;
            font-weight: 500;
            z-index: 20;
        }

        /* Mode Toggle */
        .mode-toggle {
            background: white;
            border-radius: 15px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid #28a745;
        }

        .form-check-input {
            width: 3rem;
            height: 1.5rem;
            margin-top: 0;
        }

        .form-check-input:checked {
            background-color: #28a745;
            border-color: #28a745;
        }

        /* Alerts */
        .alert {
            border-radius: 15px;
            border: none;
            margin: 1rem 0;
        }

        .alert-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
        }

        .alert-danger {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            color: white;
        }

        .alert-warning {
            background: linear-gradient(135deg, #ffa726 0%, #ff7043 100%);
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .page-title {
                font-size: 2rem;
            }
            
            .main-container {
                padding: 0 1rem;
            }
            
            .template-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .template-preview {
                height: 140px;
                /* Maintain A0 aspect ratio on mobile */
                aspect-ratio: 1 / 1.414;
            }
        }
        
        @media (max-width: 480px) {
            .template-grid {
                gap: 1.5rem;
            }
            
            .template-preview {
                height: 120px;
                /* Maintain A0 aspect ratio on small mobile */
                aspect-ratio: 1 / 1.414;
            }
        }

        /* Preview Modal Styles */
        .preview-modal {
            display: none;
            position: fixed;
            z-index: 1050;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.9) 0%, rgba(118, 75, 162, 0.9) 100%);
            backdrop-filter: blur(10px);
            overflow-y: auto;
            padding: 20px;
        }

        .preview-modal-content {
            background: white;
            margin: 20px auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 900px;
            max-height: calc(100vh - 40px);
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.4s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .preview-modal-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 20px 20px 0 0;
        }

        .preview-modal-header h5 {
            font-size: 1.2rem;
            font-weight: 700;
            margin: 0;
            display: flex;
            align-items: center;
        }

        .preview-modal-header h5 i {
            margin-right: 0.75rem;
            font-size: 1.3rem;
        }

        .preview-modal-body {
            padding: 1.5rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .preview-image-container {
            background: white;
            border-radius: 15px;
            padding: 1rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }

        .preview-image {
            width: 100%;
            height: auto;
            max-height: 50vh;
            object-fit: contain;
            display: block;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .preview-close {
            color: white;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .preview-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .preview-btn {
            background: rgba(108, 117, 125, 0.8);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            backdrop-filter: blur(5px);
        }

        .preview-btn:hover {
            background: rgba(108, 117, 125, 0.9);
            transform: translateY(-2px);
        }

        .template-description {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #4facfe;
        }

        .template-description h6 {
            color: #333;
            margin-bottom: 1.5rem;
            font-weight: 700;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
        }

        .template-description h6 i {
            margin-right: 0.5rem;
            color: #4facfe;
        }

        .template-description p {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 1.5rem;
            color: #555;
        }

        .template-description ul {
            font-size: 0.95rem;
            padding-left: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .template-description li {
            margin-bottom: 0.75rem;
            color: #555;
            line-height: 1.5;
        }

        .template-description .ideal-for {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            padding: 1.5rem;
            border-radius: 15px;
            margin-top: 1.5rem;
            border-left: 5px solid #4facfe;
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.1);
        }

        .template-description .ideal-for strong {
            color: #4facfe;
            font-weight: 700;
        }

        .preview-actions {
            text-align: center;
            margin-top: 1.5rem;
        }

        .preview-actions .btn {
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 25px;
            box-shadow: 0 10px 25px rgba(79, 172, 254, 0.3);
            transition: all 0.3s ease;
        }

        .preview-actions .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(79, 172, 254, 0.4);
        }

        /* Landing Page Styles */
        .landing-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .landing-content {
            max-width: 1000px;
            width: 100%;
            text-align: center;
        }

        .landing-header {
            margin-bottom: 4rem;
        }

        .landing-title {
            font-size: 3.5rem;
            font-weight: 800;
            color: white;
            margin-bottom: 1.5rem;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .landing-subtitle {
            font-size: 1.3rem;
            color: rgba(255, 255, 255, 0.9);
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .landing-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2.5rem 2rem;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            background: rgba(255, 255, 255, 1);
        }

        .feature-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            box-shadow: 0 10px 25px rgba(79, 172, 254, 0.3);
        }

        .feature-icon i {
            font-size: 2rem;
            color: white;
        }

        .feature-card h3 {
            font-size: 1.4rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 1rem;
        }

        .feature-card p {
            color: #666;
            line-height: 1.6;
            font-size: 1rem;
        }

        .btn-create-poster {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 1.2rem 3rem;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
            margin-bottom: 1.5rem;
        }

        .btn-create-poster:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(102, 126, 234, 0.5);
            color: white;
        }

        .landing-note {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
            margin: 0;
        }

        /* Poster Creation Page Styles */
        .poster-creation-page {
            animation: fadeIn 0.8s ease-out;
        }

        /* Page Transition Styles */
        .page-transition {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s ease-out;
        }

        .page-transition.show {
            opacity: 1;
            transform: translateY(0);
        }

        .page-transition.hide {
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease-in;
        }

        /* Ensure landing page is visible by default */
        #landingPage {
            opacity: 1;
            transform: translateY(0);
        }

        /* Responsive Design for Template Grid */
        @media (max-width: 768px) {
            .template-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
            }
            
            .template-card {
                min-height: 250px;
            }
            
            .template-preview img {
                max-height: 250px;
            }
        }

        @media (max-width: 480px) {
            .template-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .template-card {
                min-height: 200px;
            }
            
            .template-preview img {
                max-height: 200px;
            }
        }

        @keyframes pulse-badge {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }
        .new-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border-radius: 16px;
            padding: 4px 8px;
            font-size: 0.65rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 4px;
            box-shadow: 0 2px 6px rgba(40, 167, 69, 0.3);
            z-index: 20;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            animation: pulse-badge 1.2s infinite cubic-bezier(0.4, 0.2, 0.2, 1);
        }
        .new-badge:hover {
            transform: scale(1.15);
        }

        .alpha-banner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 32px;
            background: #f5f6fa;
            color: #222;
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 1px solid #d1d5db;
            z-index: 2000;
            letter-spacing: 0.01em;
            box-shadow: 0 1px 4px rgba(0,0,0,0.02);
        }
        
        /* Add top margin to main content to prevent overlap */
        #landingPage, #posterCreationPage, main, .main-container, .content-card, .features-section, .how-it-works, .template-showcase, .stats-section, .faq-section, .footer {
            margin-top: 32px;
        }
        @media (max-width: 600px) {
            .alpha-banner {
                font-size: 0.95rem;
                height: 36px;
            }
            #landingPage, #posterCreationPage, main, .main-container, .content-card, .features-section, .how-it-works, .template-showcase, .stats-section, .faq-section, .footer {
                margin-top: 36px;
            }
        }

        .alpha-banner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 32px;
            background: #f5f6fa;
            color: #222;
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 1px solid #d1d5db;
            z-index: 2000;
            letter-spacing: 0.01em;
            box-shadow: 0 1px 4px rgba(0,0,0,0.02);
            padding-left: 1.5rem;
            position: relative;
        }
        .logo-link {
            display: flex;
            align-items: center;
            height: 100%;
            text-decoration: none;
            position: absolute;
            left: 1.5rem;
            top: 0;
        }
        .alpha-logo {
            height: 44px;
            width: auto;
            display: block;
            margin-right: 0.5rem;
        }
        .alpha-banner-text {
            display: inline-block;
            vertical-align: middle;
        }
        /* Add top margin to main content to prevent overlap */
        #landingPage, #posterCreationPage, main, .main-container, .content-card, .features-section, .how-it-works, .template-showcase, .stats-section, .faq-section, .footer {
            margin-top: 32px;
        }
        @media (max-width: 600px) {
            .alpha-banner {
                font-size: 0.95rem;
                height: 36px;
                padding-left: 0.5rem;
            }
            .alpha-logo {
                height: 36px;
            }
            #landingPage, #posterCreationPage, main, .main-container, .content-card, .features-section, .how-it-works, .template-showcase, .stats-section, .faq-section, .footer {
                margin-top: 36px;
            }

                    /* Figure Preview Styles */
        .figure-preview-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 1rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .figure-preview-container img {
            transition: transform 0.2s ease;
        }

        .figure-preview-container img:hover {
            transform: scale(1.02);
        }

        /* Upload Area Transitions */
        .upload-area {
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        #uploadContent {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }



            .upload-area.dragover {
                border-color: var(--primary-color);
                background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(124, 58, 237, 0.1));
                transform: scale(1.02);
            }

            /* File info and preview styles */
            .file-info {
                position: relative;
                z-index: 20;
                pointer-events: auto;
            }

            .figure-preview-container button {
                position: relative;
                z-index: 30;
                pointer-events: auto;
            }

            /* Preview overlay hover effect */
            .figure-preview-container div[style*="position: relative; display: inline-block"]:hover .preview-overlay {
                opacity: 1 !important;
            }

            /* PDF Preview Styles */
            .pdf-preview-container {
                background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.98) 100%);
                border-radius: 20px;
                padding: 1.5rem;
                box-shadow: var(--shadow-md);
                border: 1px solid rgba(255, 255, 255, 0.2);
                backdrop-filter: blur(10px);
                transition: all 0.3s ease;
                gap: 1.5rem;
            }

            .pdf-preview-container:hover {
                box-shadow: var(--shadow-lg);
                transform: translateY(-2px);
            }

            .pdf-preview-canvas {
                width: 100%;
                height: 400px;
                border-radius: 16px;
                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
                border: 3px solid var(--border-color);
                background: white;
                object-fit: contain;
            }

            #pdf-canvas-container {
                width: 100%;
                height: 400px;
                padding: 1.5rem;
                box-shadow: var(--shadow-xl);
                border-radius: 16px;
                background: white;
                display: flex;
                align-items: center;
                justify-content: center;
                position: relative;
            }

            .pdf-preview-info {
                font-size: 1rem;
                color: var(--text-primary);
                flex-direction: column;
                gap: 0.5rem;
            }

            .pdf-preview-info .filename {
                font-weight: 700;
                font-size: 1.1rem;
                color: var(--text-primary);
            }

            .pdf-preview-info .file-details {
                font-size: 0.9rem;
                color: var(--text-secondary);
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .pdf-preview-actions {
                display: flex;
                gap: 0.75rem;
                margin-top: 1rem;
            }

            .pdf-preview-btn.remove {
                padding: 0.75rem 1.25rem;
                border-radius: 12px;
                font-size: 0.9rem;
                gap: 0.5rem;
                box-shadow: var(--shadow-sm);
                background: linear-gradient(135deg, var(--error-color), #dc2626);
                border: none;
                color: white;
                font-weight: 600;
                transition: all 0.3s ease;
            }

            .pdf-preview-btn.remove:hover {
                transform: translateY(-1px);
                box-shadow: var(--shadow-md);
                background: linear-gradient(135deg, #dc2626, #b91c1c);
            }

            .pdf-loading {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 1rem;
                padding: 2rem;
                color: var(--text-secondary);
            }

            .pdf-loading .spinner-border {
                width: 2rem;
                height: 2rem;
                border-width: 0.2rem;
            }
        }


    </style>
</head>
<body>
            <!-- Alpha Banner with Logo -->
        <div class="alpha-banner">
            <a href="/" class="logo-link">
                <img src="/static/PosterFormBlackLogo.png" alt="PosterForm Logo" class="alpha-logo">
            </a>
            <span class="alpha-banner-text">🚧 This tool is in Alpha – features are being actively developed and you may experience some errors.</span>
        </div>

    <!-- Modern Landing Page -->
    <div id="landingPage" class="landing-page">
        <!-- Hero Section -->
        <section class="landing-hero">
            <div class="hero-content">
                <div class="hero-logo">
                    <img src="/static/PosterFormWhiteLogo.png" alt="PosterForm Logo" class="hero-logo-image">
                </div>
                
                <h1 class="hero-title">
                    Transform Your Research Into<br>
                    <span style="background: linear-gradient(135deg, #10b981, #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Stunning Academic Posters</span>
                </h1>
                
                <p class="hero-subtitle">
                    Upload your research PDF and let our AI extract key information to create professional, publication-ready academic posters in minutes.
                </p>
                
                <div class="hero-cta">
                    <a href="#" class="btn-primary" onclick="showPosterCreation()">
                        <i class="fas fa-magic"></i>
                        Get started for FREE
                    </a>
                    <a href="#features" class="btn-secondary">
                        <i class="fas fa-play"></i>
                        See How It Works
                    </a>
                </div>
            </div>
        </section>

        <!-- Template Showcase Section -->
        <section class="template-showcase">
            <div class="showcase-header">
                <h2 class="showcase-title">Professional Templates</h2>
                <p class="showcase-subtitle">
                    Choose from our curated collection of academic poster templates designed for conferences and publications
                </p>
            </div>
            
            <div class="template-scroll-container">
                <div class="template-scroll-track" id="templateScrollTrack">
                    <!-- Template cards will be populated by JavaScript -->
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section id="features" class="features-section">
            <div class="features-container">
                <div class="section-header">
                    <h2 class="section-title">Why Choose Our Platform?</h2>
                    <p class="section-subtitle">
                        Smart support for busy researchers. This tool uses AI to repackage, not rewrite, your research — making it faster and easier to create stunning academic posters, without losing your voice.
                    </p>
                </div>
                
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-brain"></i>
                        </div>
                        <h3 class="feature-title">AI-Powered Extraction</h3>
                        <p class="feature-description">
                            Upload your PDF and let the AI identify key details — title, authors, methods, results, conclusions — so you don't have to copy-paste or reformat.
                        </p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-palette"></i>
                        </div>
                        <h3 class="feature-title">Professional Templates</h3>
                        <p class="feature-description">
                            Choose from a growing library of clean, academic templates designed for conferences. Structured, polished, and fully editable once downloaded.
                        </p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-image"></i>
                        </div>
                        <h3 class="feature-title">Figure Integration</h3>
                        <p class="feature-description">
                            Add up to 4 figures with captions to give your poster visual impact. No need to fight with layout — they'll be placed where they belong.
                        </p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-download"></i>
                        </div>
                        <h3 class="feature-title">Instant Download</h3>
                        <p class="feature-description">
                            Once generated, your PowerPoint file is ready to download, tweak, and present — no extra software or waiting around.
                        </p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <h3 class="feature-title">Save Time</h3>
                        <p class="feature-description">
                            Posters that used to take hours (or days) to format now take minutes. Let AI handle the structure — you focus on the science.
                        </p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3 class="feature-title">Privacy First</h3>
                        <p class="feature-description">
                            Your research stays yours. We process your file securely, extract what's needed, and never store or share your data.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- How It Works Section -->
        <section class="how-it-works">
            <div class="steps-container">
                <div class="section-header">
                    <h2 class="section-title">How It Works</h2>
                    <p class="section-subtitle">
                        Three simple steps to create your academic poster:
                    </p>
                </div>
                
                <div class="steps-grid">
                    <div class="step-card">
                        <div class="step-number">1</div>
                        <h3 class="step-title">Upload Your Research</h3>
                        <p class="step-description">
                            Upload your manuscript as a PDF. The AI will scan and extract the key information automatically.
                        </p>
                    </div>
                    
                    <div class="step-card">
                        <div class="step-number">2</div>
                        <h3 class="step-title">Choose Your Template</h3>
                        <p class="step-description">
                            Pick from professionally designed layouts that match your style or needs.
                        </p>
                    </div>
                    
                    <div class="step-card">
                        <div class="step-number">3</div>
                        <h3 class="step-title">Download & Present</h3>
                        <p class="step-description">
                            Instantly get a PowerPoint file you can edit, brand, and share — ready for any conference.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Early Access Section -->
        <section class="stats-section">
            <div class="stats-container">
                <div class="section-header">
                    <h2 class="section-title" style="color: white;">Be the First to Try It</h2>
                    <p class="section-subtitle" style="color: white; opacity: 0.9; margin-bottom: 2rem;">
                        Launching soon — be part of the early wave.<br>
                        We're opening access to researchers who want to test, shape, and improve the tool before public release.
                    </p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-number">✅</span>
                        <div class="stat-label">Free early access for beta users</div>
                    </div>
                    
                    <div class="stat-item">
                        <span class="stat-number">🛠</span>
                        <div class="stat-label">Help shape the final features</div>
                    </div>
                    
                    <div class="stat-item">
                        <span class="stat-number">💡</span>
                        <div class="stat-label">Ideal for PhD students, postdocs, and early-career researchers</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- FAQ Section -->
        <section class="faq-section">
            <div class="faq-container">
                <div class="faq-header">
                    <h2 class="faq-title">Frequently Asked Questions</h2>
                    <p class="faq-subtitle">Everything you need to know about creating professional academic posters</p>
                </div>
                
                <div class="faq-list">
                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(this)">
                            <span>What is PosterForm.ai?</span>
                            <div class="faq-icon">+</div>
                        </div>
                        <div class="faq-answer">
                            <div class="faq-answer-content">
                                PosterForm.ai helps researchers quickly turn their academic papers into editable, professional research posters. You upload your PDF, choose a template, and the AI extracts and formats your content into a PowerPoint file you can tweak and present.
                            </div>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(this)">
                            <span>What stage of development is the tool in?</span>
                            <div class="faq-icon">+</div>
                        </div>
                        <div class="faq-answer">
                            <div class="faq-answer-content">
                                We're currently in alpha — the core features are live, but we're still improving things based on feedback.<br><br>If you're reading this, you're a tester — thank you! Your input helps shape what comes next.
                            </div>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(this)">
                            <span>Does the tool use generative AI to write my content?</span>
                            <div class="faq-icon">+</div>
                        </div>
                        <div class="faq-answer">
                            <div class="faq-answer-content">
                                No — the tool doesn't write or rewrite your work. It extracts the content from your existing manuscript and places it into a poster layout. You stay in control of everything.
                            </div>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(this)">
                            <span>Can I edit the poster once it's generated?</span>
                            <div class="faq-icon">+</div>
                        </div>
                        <div class="faq-answer">
                            <div class="faq-answer-content">
                                Yes. The output is a fully editable PowerPoint file. You can update text, add visuals, change colours, or include logos — just like any presentation.
                            </div>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(this)">
                            <span>What kind of files work best?</span>
                            <div class="faq-icon">+</div>
                        </div>
                        <div class="faq-answer">
                            <div class="faq-answer-content">
                                The tool accepts PDF files. It works best with clean, well-structured manuscripts. If your paper has unusual formatting, you might need to adjust a few things manually after download.
                            </div>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(this)">
                            <span>Can I include figures, tables, or branding?</span>
                            <div class="faq-icon">+</div>
                        </div>
                        <div class="faq-answer">
                            <div class="faq-answer-content">
                                Absolutely. The templates include placeholder areas for visuals, and you can add anything you like — logos, QR codes, project images — after download.
                            </div>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(this)">
                            <span>Is my research data safe?</span>
                            <div class="faq-icon">+</div>
                        </div>
                        <div class="faq-answer">
                            <div class="faq-answer-content">
                                Yes. Your file is processed temporarily to extract content and isn't stored or shared. We don't keep your data after generation.
                            </div>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(this)">
                            <span>How can I share feedback?</span>
                            <div class="faq-icon">+</div>
                        </div>
                        <div class="faq-answer">
                            <div class="faq-answer-content">
                                We'd love to hear from you. Whether it's something that didn't work as expected or a feature you'd like to see, your feedback is essential during this phase.<br><br><a href="#" class="feedback-link">Submit Feedback</a> (link to form or email)
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <p class="footer-text">
                    Academic Poster Creator - Making research presentation easier and more professional
                </p>
                <div class="footer-links">
                    <a href="#" class="footer-link" onclick="showPosterCreation()">Get Started</a>
                    <a href="#features" class="footer-link">Features</a>
                    <a href="#" class="footer-link">Privacy Policy</a>
                    <a href="#" class="footer-link">Terms of Service</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Poster Creation Page -->
    <div id="posterCreationPage" class="poster-creation-page" style="display: none;">
        <!-- Navigation Back Button -->
        <a href="#" class="nav-back show" onclick="showLandingPage()">
            <i class="fas fa-arrow-left"></i>
            Back to Home
        </a>

        <!-- Hero Section for Poster Creation -->
        <section class="landing-hero" style="min-height: 60vh; padding: 4rem 2rem;">
            <div class="hero-content">
                <div class="hero-logo" style="margin-bottom: 1rem;">
                    <img src="/static/PosterFormWhiteLogo.png" alt="PosterForm Logo" class="hero-logo-image" style="height: 80px;">
                </div>
                
                <h1 class="hero-title" style="font-size: clamp(2rem, 4vw, 3rem); margin-bottom: 1rem;">
                    <i class="fas fa-magic me-3"></i>
                    Create Your Academic Poster
                </h1>
                
                <p class="hero-subtitle" style="font-size: 1.1rem; margin-bottom: 2rem;">
                    Upload your research PDF and let our AI transform it into a professional academic poster in minutes
                </p>
                
                <div class="hero-badge" style="margin-bottom: 2rem;">
                    <i class="fas fa-rocket"></i>
                    AI-Powered • Professional Templates • Instant Download
                </div>
            </div>
        </section>

        <!-- Main Content -->
        <div class="main-container" style="margin-top: -4rem; position: relative; z-index: 10;">
            <div class="content-card" style="border-radius: 32px; box-shadow: var(--shadow-xl);">
            
            <div class="content-body" style="padding: 2rem;">
                <form id="uploadForm" enctype="multipart/form-data">
                    <input type="hidden" name="selected_template" id="selectedTemplateInput" value="default">
                    
                    <!-- Mode Toggle -->
                    <div class="form-section" style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.98) 100%); border: 1px solid rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px);">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5 class="mb-1" style="color: var(--text-primary); font-weight: 700;">
                                    <i class="fas fa-cog me-2" style="color: var(--primary-color);"></i>Processing Mode
                                </h5>
                                <small class="text-muted">
                                    <span id="modeDescription">Using API for fresh results</span>
                                </small>
                            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="dummyDataToggle">
                                <label class="form-check-label" for="dummyDataToggle">
                                    <span id="toggleLabel">API Mode</span>
                                </label>
                            </div>
                        </div>
                        <div class="mt-2">
                            <small class="text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                <span id="modeInfo">API Mode: Calls OpenAI API for fresh results</span>
                            </small>
                        </div>
                        
                        <!-- AI Provider Selection -->
                        <div class="ai-provider-section" id="aiProviderSection" style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.95) 100%); border: 1px solid rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px); border-radius: 20px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);">
                            <div class="ai-provider-header">
                                <div class="ai-provider-title">
                                    <div class="ai-provider-icon" style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));">
                                        <i class="fas fa-robot"></i>
                                    </div>
                                    <div class="ai-provider-text">
                                        <h6 class="mb-0" style="color: var(--text-primary); font-weight: 700;">AI Provider</h6>
                                        <small class="text-muted" id="providerStatus">Loading...</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="ai-provider-toggle-container">
                                <div class="ai-provider-toggle" id="providerToggleGroup">
                                    <input type="radio" class="ai-provider-radio" name="aiProvider" id="openaiProvider" value="openai" checked>
                                    <label class="ai-provider-option openai-option" for="openaiProvider">
                                        <div class="ai-provider-option-icon">
                                            <i class="fab fa-openai"></i>
                                        </div>
                                        <div class="ai-provider-option-text">
                                            <span class="ai-provider-name">ChatGPT</span>
                                            <span class="ai-provider-model">GPT-4o</span>
                                        </div>
                                        <div class="ai-provider-option-indicator"></div>
                                    </label>
                                    
                                    <input type="radio" class="ai-provider-radio" name="aiProvider" id="anthropicProvider" value="anthropic">
                                    <label class="ai-provider-option anthropic-option" for="anthropicProvider">
                                        <div class="ai-provider-option-icon">
                                            <i class="fas fa-brain"></i>
                                        </div>
                                        <div class="ai-provider-option-text">
                                            <span class="ai-provider-name">Claude</span>
                                            <span class="ai-provider-model">3.5 Sonnet</span>
                                        </div>
                                        <div class="ai-provider-option-indicator"></div>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="ai-provider-info">
                                <i class="fas fa-lightbulb me-1"></i>
                                <span id="providerInfo">Choose your preferred AI provider</span>
                            </div>
                        </div>
                        
                        <!-- Dummy Data Status -->
                        <div class="mt-3 pt-3 border-top" id="dummyDataStatus" style="display: none;">
                            <div id="dummyDataInfo">
                                <div class="text-center">
                                    <div class="spinner-border spinner-border-sm me-2"></div>
                                    <small>Checking dummy data availability...</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PDF Upload (API Mode) -->
                    <div class="form-section" id="pdfUploadSection" style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.98) 100%); border: 1px solid rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px);">
                        <h5 style="color: var(--text-primary); font-weight: 700;">
                            <i class="fas fa-file-pdf me-2" style="color: var(--primary-color);"></i>Research Document
                        </h5>
                        
                        <div class="upload-area" id="pdfUploadArea" style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.9) 100%); border: 2px dashed var(--primary-color); border-radius: 24px; padding: 3rem 2rem; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                            <!-- Upload Content (shown when no file) -->
                            <div id="uploadContent">
                                <i class="fas fa-cloud-upload-alt fa-3x mb-3" style="color: var(--primary-color);"></i>
                                <h5 style="color: var(--text-primary); font-weight: 600;">Drop your research PDF here</h5>
                                <p class="text-muted" id="uploadDescription">Upload your academic paper or research document</p>
                                <input type="file" class="file-input" id="pdfFile" name="pdf_file" accept=".pdf" required>
                                <button type="button" class="btn btn-upload" onclick="document.getElementById('pdfFile').click()" style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); border: none; color: white; padding: 1rem 2rem; border-radius: 16px; font-weight: 600; box-shadow: var(--shadow-md);">
                                    <i class="fas fa-upload me-2"></i>Choose PDF
                                </button>
                            </div>

                            <!-- PDF Upload Confirmation (shown when file is uploaded) -->
                            <div id="pdfPreviewContent" style="display: none; width: 100%;">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="pdf-preview-info">
                                            <div class="filename" id="pdfFileName"></div>
                                            <div class="file-details" id="pdfFileDetails"></div>
                                            <div class="pdf-preview-actions">
                                                <button type="button" class="btn pdf-preview-btn remove" onclick="removePdf()">
                                                    <i class="fas fa-trash me-1"></i>Remove PDF
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div id="pdf-canvas-container">
                                            <!-- PDF preview will be rendered here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                <!-- Template Selection -->
                <div class="form-section" style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.98) 100%); border: 1px solid rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px);">
                    <h5 style="color: var(--text-primary); font-weight: 700;">
                        <i class="fas fa-file-powerpoint me-2" style="color: var(--primary-color);"></i>Choose Template
                    </h5>
                    <p class="text-muted mb-3">Select from our professional academic poster templates</p>
                    <div class="template-grid" id="templateGrid">
                        <!-- Templates will be populated here -->
                    </div>
                </div>

                <!-- Figure Uploads -->
                <div class="form-section" id="figureUploadSection" style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.98) 100%); border: 1px solid rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px);">
                    <h5 style="color: var(--text-primary); font-weight: 700;">
                        <i class="fas fa-image me-2" style="color: var(--primary-color);"></i>Figures (Optional)
                    </h5>
                    <p class="text-muted mb-3">Add up to 4 figures to enhance your poster's visual impact</p>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="upload-area" id="figure1UploadArea" style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.9) 100%); border: 2px dashed var(--border-color); border-radius: 20px; padding: 2rem 1.5rem;">
                                <i class="fas fa-image fa-2x mb-2" style="color: var(--primary-color);"></i>
                                <h6 style="color: var(--text-primary); font-weight: 600;">Figure 1</h6>
                                <input type="file" class="file-input" id="figure1File" name="figure1_file" accept=".png,.jpg,.jpeg">
                                <button type="button" class="btn btn-upload btn-sm" onclick="document.getElementById('figure1File').click()" style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); border: none; color: white; padding: 0.75rem 1.5rem; border-radius: 12px; font-weight: 600; box-shadow: var(--shadow-sm);">
                                    <i class="fas fa-upload me-1"></i>Upload
                                </button>
                                <div class="file-info" id="figure1FileInfo" style="display: none;"></div>
                                
                                <!-- Figure Description -->
                                <div class="figure-description-section" style="margin-top: 1rem; position: relative; z-index: 10;">
                                    <label for="figure1Description" class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 0.5rem;">Figure Description:</label>
                                    <textarea class="form-control" id="figure1Description" name="figure1_description" rows="2" placeholder="Enter a description for Figure 1..." style="border-radius: 8px; border: 1px solid #dee2e6; position: relative; z-index: 10; pointer-events: auto;"></textarea>
                                </div>

                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="upload-area" id="figure2UploadArea" style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.9) 100%); border: 2px dashed var(--border-color); border-radius: 20px; padding: 2rem 1.5rem;">
                                <i class="fas fa-image fa-2x mb-2" style="color: var(--primary-color);"></i>
                                <h6 style="color: var(--text-primary); font-weight: 600;">Figure 2</h6>
                                <input type="file" class="file-input" id="figure2File" name="figure2_file" accept=".png,.jpg,.jpeg">
                                <button type="button" class="btn btn-upload btn-sm" onclick="document.getElementById('figure2File').click()" style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); border: none; color: white; padding: 0.75rem 1.5rem; border-radius: 12px; font-weight: 600; box-shadow: var(--shadow-sm);">
                                    <i class="fas fa-upload me-1"></i>Upload
                                </button>
                                <div class="file-info" id="figure2FileInfo" style="display: none;"></div>
                                
                                <!-- Figure Description -->
                                <div class="figure-description-section" style="margin-top: 1rem; position: relative; z-index: 10;">
                                    <label for="figure2Description" class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 0.5rem;">Figure Description:</label>
                                    <textarea class="form-control" id="figure2Description" name="figure2_description" rows="2" placeholder="Enter a description for Figure 2..." style="border-radius: 8px; border: 1px solid #dee2e6; position: relative; z-index: 10; pointer-events: auto;"></textarea>
                                </div>

                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="upload-area" id="figure3UploadArea" style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.9) 100%); border: 2px dashed var(--border-color); border-radius: 20px; padding: 2rem 1.5rem;">
                                <i class="fas fa-image fa-2x mb-2" style="color: var(--primary-color);"></i>
                                <h6 style="color: var(--text-primary); font-weight: 600;">Figure 3</h6>
                                <input type="file" class="file-input" id="figure3File" name="figure3_file" accept=".png,.jpg,.jpeg">
                                <button type="button" class="btn btn-upload btn-sm" onclick="document.getElementById('figure3File').click()" style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); border: none; color: white; padding: 0.75rem 1.5rem; border-radius: 12px; font-weight: 600; box-shadow: var(--shadow-sm);">
                                    <i class="fas fa-upload me-1"></i>Upload
                                </button>
                                <div class="file-info" id="figure3FileInfo" style="display: none;"></div>
                                
                                <!-- Figure Description -->
                                <div class="figure-description-section" style="margin-top: 1rem; position: relative; z-index: 10;">
                                    <label for="figure3Description" class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 0.5rem;">Figure Description:</label>
                                    <textarea class="form-control" id="figure3Description" name="figure3_description" rows="2" placeholder="Enter a description for Figure 3..." style="border-radius: 8px; border: 1px solid #dee2e6; position: relative; z-index: 10; pointer-events: auto;"></textarea>
                                </div>

                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="upload-area" id="figure4UploadArea" style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.9) 100%); border: 2px dashed var(--border-color); border-radius: 20px; padding: 2rem 1.5rem;">
                                <i class="fas fa-image fa-2x mb-2" style="color: var(--primary-color);"></i>
                                <h6 style="color: var(--text-primary); font-weight: 600;">Figure 4</h6>
                                <input type="file" class="file-input" id="figure4File" name="figure4_file" accept=".png,.jpg,.jpeg">
                                <button type="button" class="btn btn-upload btn-sm" onclick="document.getElementById('figure4File').click()" style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); border: none; color: white; padding: 0.75rem 1.5rem; border-radius: 12px; font-weight: 600; box-shadow: var(--shadow-sm);">
                                    <i class="fas fa-upload me-1"></i>Upload
                                </button>
                                <div class="file-info" id="figure4FileInfo" style="display: none;"></div>
                                
                                <!-- Figure Description -->
                                <div class="figure-description-section" style="margin-top: 1rem; position: relative; z-index: 10;">
                                    <label for="figure4Description" class="form-label" style="font-weight: 600; color: #495057; margin-bottom: 0.5rem;">Figure Description:</label>
                                    <textarea class="form-control" id="figure4Description" name="figure4_description" rows="2" placeholder="Enter a description for Figure 4..." style="border-radius: 8px; border: 1px solid #dee2e6; position: relative; z-index: 10; pointer-events: auto;"></textarea>
                                </div>

                            </div>
                        </div>
                    </div>
                    

                </div>

                <!-- Dummy Mode Notice -->
                <div class="alert alert-info" id="dummyModeNotice" style="display: none; background: linear-gradient(135deg, rgba(79, 172, 254, 0.1), rgba(0, 242, 254, 0.1)); border: 1px solid rgba(79, 172, 254, 0.2); color: var(--text-primary); border-radius: 16px;">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Dummy Mode Active</strong><br>
                    <small>Using saved dummy data - no PDF upload required.</small>
                </div>

                <!-- Create Button -->
                <button type="submit" class="btn btn-process" id="processBtn" style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); border: none; color: white; padding: 1.5rem 3rem; border-radius: 20px; font-weight: 700; font-size: 1.2rem; width: 100%; margin-top: 2rem; box-shadow: var(--shadow-lg); position: relative; overflow: hidden; transition: all 0.3s ease;">
                    <i class="fas fa-magic me-2"></i>
                    <span id="processBtnText">Create Academic Poster</span>
                    <div style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent); transition: left 0.5s;"></div>
                </button>
            </form>

                <!-- Alerts -->
                <div id="alertContainer"></div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <button type="button" class="btn-close position-absolute" style="right: 1rem; top: 1rem; z-index: 10;" onclick="hideLoading()" title="Close"></button>
            <div class="loading-spinner"></div>
            <h3 id="loadingTitle">Creating Your Poster</h3>
            <p id="loadingSubtitle">Please wait while we process your research...</p>
            
            <div id="progressSection">
                <div class="progress-container">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Progress</span>
                        <span id="progressText">0%</span>
                    </div>
                    <div class="progress">
                        <div class="progress-bar" id="progressBar" role="progressbar" style="width: 0%"></div>
                    </div>
                </div>

                <!-- AI Provider Indicator -->
                <div class="ai-provider-indicator" id="aiProviderIndicator" style="display: none;">
                    <div class="ai-provider-badge">
                        <i class="fas fa-robot me-2"></i>
                        <span id="aiProviderName">Processing with AI...</span>
                    </div>
                </div>
                <!-- Dummy Mode Indicator -->
                <div class="dummy-indicator" id="dummyIndicator" style="display: none;">
                    <div class="dummy-badge" style="background: #f5c542; color: #333; border-radius: 18px; padding: 0.75rem 2rem; font-weight: 600; font-size: 1.1rem; display: flex; align-items: center; box-shadow: 0 4px 24px rgba(245,197,66,0.15); margin: 0 auto 1rem auto; justify-content: center;">
                        <i class="fas fa-box-open me-2"></i>
                        <span id="dummyProviderName">Processed with Dummy Data (No AI)</span>
                    </div>
                </div>

                <div class="loading-steps">
                    <div class="loading-step" id="step1">
                        <i class="fas fa-file-pdf"></i>
                        <span>Extracting content from PDF...</span>
                    </div>
                    <div class="loading-step" id="step2">
                        <i class="fas fa-brain"></i>
                        <span>Processing with AI...</span>
                    </div>
                    <div class="loading-step" id="step3">
                        <i class="fas fa-palette"></i>
                        <span>Applying template styling...</span>
                    </div>
                    <div class="loading-step" id="step4">
                        <i class="fas fa-image"></i>
                        <span>Inserting figures...</span>
                    </div>
                    <div class="loading-step" id="step5">
                        <i class="fas fa-check-circle"></i>
                        <span>Finalizing poster...</span>
                    </div>
                </div>
            </div>

            <!-- Extracted Data Preview (initially hidden) -->
            <div id="extractedDataPreview" style="display: none;">
                <h6 class="text-center mb-3">
                    <i class="fas fa-eye me-2"></i>Extracted Information Preview
                </h6>
                <div id="extractedDataContent" class="text-left">
                    <!-- Extracted data will be populated here -->
                </div>
                <div class="alert alert-info mt-3" style="font-size: 1rem;">
                    <strong>Disclaimer:</strong> Your poster is <u>fully editable</u>! Please review and adjust the content, layout, and figures as needed before presenting or submitting. The AI does its best, but your final review ensures everything is accurate and looks great.
                </div>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div class="preview-modal" id="previewModal">
        <div class="preview-modal-content">
            <div class="preview-modal-header">
                <h5 id="previewTemplateTitle">
                    <i class="fas fa-eye"></i>Template Preview
                </h5>
                <button class="preview-close" onclick="closePreviewModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="preview-modal-body">
                <div class="row">
                    <div class="col-lg-8">
                        <div class="preview-image-container">
                            <img src="" alt="Template Preview" class="preview-image" id="previewImage">
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="template-description" id="templateDescription">
                            <div class="text-center">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2 text-muted">Loading template details...</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="preview-actions">
                    <button class="btn btn-process" onclick="selectTemplateFromPreview()">
                        <i class="fas fa-check me-2"></i>Select This Template
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Modal -->
    <div class="modal-overlay" id="resultsModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <button class="modal-close" onclick="closeResultsModal()">
                    <i class="fas fa-times"></i>
                </button>
                <h2><i class="fas fa-check-circle me-2"></i>Poster Created Successfully!</h2>
                <p class="mb-0">Your academic poster is ready for download</p>
            </div>
            
            <div class="modal-body">
                <div id="extractedData" class="mb-4">
                    <!-- Extracted data will be shown here -->
                </div>
                
                <div class="text-center">
                    <a href="#" id="downloadLink" class="btn btn-process">
                        <i class="fas fa-download me-2"></i>Download Poster
                    </a>
                    <button class="btn btn-outline-secondary ms-2" onclick="createAnother()">
                        <i class="fas fa-plus me-2"></i>Create Another
                    </button>
                </div>
            </div>
        </div>
    </div>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js?v=20250724"></script>
    <script src="https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.min.js?v=1"></script>
    <script>
        // Set PDF.js worker path
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.worker.min.js';
    </script>
    <script>
        // Global variables
        let selectedTemplateFilename = 'default';
        let currentStep = 0;
        const totalSteps = 5;
        
        // Emergency scroll restoration function
        function forceRestoreScrolling() {
            document.body.style.overflow = '';
            document.documentElement.style.overflow = '';
            document.body.style.position = '';
            document.body.style.top = '';
            document.body.style.left = '';
            document.body.style.right = '';
            document.body.style.bottom = '';
            document.body.style.width = '';
            document.body.style.height = '';
            
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.display = 'none';
                overlay.classList.remove('show');
            }
            
            window.scrollTo(0, 0);
            console.log('Scrolling forcefully restored');
        }
        
        // Add keyboard shortcut to restore scrolling (Ctrl+Shift+R)
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'R') {
                e.preventDefault();
                forceRestoreScrolling();
                alert('Scrolling has been restored!');
            }
        });

        // Modal functions
        function closeResultsModal() {
            document.getElementById('resultsModal').style.display = 'none';
        }

        function startOver() {
            // Hide the loading modal first
            hideLoading();
            // Refresh the page to start completely fresh
            window.location.reload();
        }

        // Load initial data
        function loadInitialData() {
            // Load each API separately to handle individual failures
            fetch('/api/mode')
                .then(response => response.json())
                .then(modeData => {
                    if (typeof updateToggleUI === 'function') {
                        updateToggleUI(modeData.use_dummy_data);
                    } else {
                        console.warn('updateToggleUI function not available yet');
                    }
                })
                .catch(error => {
                    console.error('Error loading mode data:', error);
                });
            
            fetch('/api/dummy-data-status')
                .then(response => response.json())
                .then(dummyData => {
                    if (typeof updateDummyDataStatus === 'function') {
                        updateDummyDataStatus(dummyData);
                    } else {
                        console.warn('updateDummyDataStatus function not available yet');
                    }
                })
                .catch(error => {
                    console.error('Error loading dummy data:', error);
                    if (typeof updateDummyDataStatus === 'function') {
                        updateDummyDataStatus({ available: false, error: error.message });
                    }
                });
            
            fetch('/api/template-library')
                .then(response => response.json())
                .then(templateData => {
                    if (typeof updateTemplateLibrary === 'function') {
                        if (templateData.success && templateData.templates) {
                            updateTemplateLibrary(templateData.templates);
                        } else {
                            updateTemplateLibrary([]);
                        }
                    } else {
                        console.warn('updateTemplateLibrary function not available yet');
                    }
                })
                .catch(error => {
                    console.error('Error loading template data:', error);
                    if (typeof updateTemplateLibrary === 'function') {
                        updateTemplateLibrary([]);
                    }
                });
            
            fetch('/api/provider')
                .then(response => response.json())
                .then(providerData => {
                    if (typeof updateProviderUI === 'function') {
                        updateProviderUI(providerData);
                    } else {
                        console.warn('updateProviderUI function not available yet');
                    }
                })
                .catch(error => {
                    console.error('Error loading provider data:', error);
                });
        }

        // File upload handling
        function setupFileUpload(inputId, areaId, infoId) {
            const input = document.getElementById(inputId);
            const area = document.getElementById(areaId);
            const info = document.getElementById(infoId);
            
            input.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    // Check if this is a PDF upload
                    const isPdfUpload = inputId === 'pdfFile';
                    // Check if this is a figure upload (not PDF)
                    const isFigureUpload = inputId.includes('figure');
                    
                    if (isPdfUpload && file.type === 'application/pdf') {
                        // Create PDF preview
                        showPdfPreview(file);
                    } else if (isFigureUpload && file.type.startsWith('image/')) {
                        // Create image preview for figures
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            info.innerHTML = `
                                <div class="figure-preview-container" style="margin-top: 1rem; position: relative; z-index: 20;">
                                    <div style="position: relative; display: inline-block;">
                                        <img src="${e.target.result}" alt="Figure Preview" style="max-width: 100%; max-height: 200px; border-radius: 8px; box-shadow: var(--shadow-sm); border: 2px solid var(--border-color); cursor: pointer;" onclick="showFullSizeImage('${e.target.result}', '${file.name}')" title="Click to view full size">
                                        <div class="preview-overlay" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); color: white; display: flex; align-items: center; justify-content: center; border-radius: 8px; opacity: 0; transition: opacity 0.2s ease; pointer-events: none;">
                                            <span style="font-size: 14px; font-weight: 500;">Preview</span>
                                        </div>
                                    </div>
                                    <div style="margin-top: 0.25rem; font-size: 0.9rem; color: var(--text-secondary);">
                                        <i class="fas fa-file-image me-1"></i>
                                        <strong>${file.name}</strong> (${(file.size / 1024 / 1024).toFixed(2)} MB)
                                        <small class="text-muted ms-2">Click image to view full size</small>
                                    </div>
                                    <button type="button" class="btn btn-sm btn-outline-danger mt-1" onclick="removeFigure('${inputId}')" style="font-size: 0.8rem; position: relative; z-index: 30; pointer-events: auto;">
                                        <i class="fas fa-trash me-1"></i>Remove
                                    </button>
                                </div>
                            `;
                            info.style.display = 'block';
                            info.style.position = 'relative';
                            info.style.zIndex = '20';
                            info.style.pointerEvents = 'auto';
                        };
                        reader.readAsDataURL(file);
                    } else {
                        // Regular file info for non-images
                        info.innerHTML = `
                            <i class="fas fa-file me-2"></i>
                            <strong>${file.name}</strong> (${(file.size / 1024 / 1024).toFixed(2)} MB)
                        `;
                        info.style.display = 'block';
                    }
                }
            });
            
            // Drag and drop functionality
            area.addEventListener('dragover', function(e) {
                e.preventDefault();
                area.classList.add('dragover');
            });
            
            area.addEventListener('dragleave', function(e) {
                e.preventDefault();
                area.classList.remove('dragover');
            });
            
            area.addEventListener('drop', function(e) {
                e.preventDefault();
                area.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    input.files = files;
                    input.dispatchEvent(new Event('change'));
                }
            });
        }



        // Remove figure function
        function removeFigure(inputId) {
            console.log(`[DEBUG] removeFigure called for: ${inputId}`);
            
            const input = document.getElementById(inputId);
            const infoId = inputId.replace('File', 'FileInfo');
            const info = document.getElementById(infoId);
            
            console.log(`[DEBUG] Found input:`, input);
            console.log(`[DEBUG] Found info:`, info);
            
            if (input && info) {
                // Clear the file input completely
                input.value = '';
                console.log(`[DEBUG] Cleared input value`);
                
                // Hide the preview/info
                info.style.display = 'none';
                info.innerHTML = '';
                console.log(`[DEBUG] Hidden info display`);
                
                // Force the input to trigger a change event to update any form state
                input.dispatchEvent(new Event('change', { bubbles: true }));
                console.log(`[DEBUG] Dispatched change event`);
                
                console.log(`[DEBUG] Successfully removed figure: ${inputId}`);
            } else {
                console.error(`[DEBUG] Could not find input or info element for: ${inputId}`);
            }
        }

        // PDF Preview with actual rendering
        async function showPdfPreview(file) {
            console.log('PDF file selected:', file.name);
            
            // Hide upload content and show preview
            const uploadContent = document.getElementById('uploadContent');
            const previewContent = document.getElementById('pdfPreviewContent');
            
            if (uploadContent) uploadContent.style.display = 'none';
            if (previewContent) previewContent.style.display = 'block';
            
            // Update file info
            const fileName = document.getElementById('pdfFileName');
            const fileDetails = document.getElementById('pdfFileDetails');
            
            if (fileName) {
                fileName.innerHTML = `${file.name}`;
            }
            
            if (fileDetails) {
                fileDetails.innerHTML = `File size: ${(file.size / 1024 / 1024).toFixed(2)} MB`;
            }
            
            // Show loading state
            const canvasContainer = document.getElementById('pdf-canvas-container');
            if (canvasContainer) {
                canvasContainer.innerHTML = `
                    <div style="background: white; border-radius: 16px; padding: 2rem; text-align: center; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); border: 3px solid #e5e7eb;">
                        <div class="spinner-border text-primary" role="status" style="width: 2rem; height: 2rem;">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p style="color: #6b7280; margin-top: 1rem;">Generating PDF preview...</p>
                    </div>
                `;
            }
            
            try {
                // Read the PDF file
                const arrayBuffer = await file.arrayBuffer();
                console.log('PDF file read successfully, size:', arrayBuffer.byteLength);
                
                // Load the PDF document
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                console.log('PDF document loaded, pages:', pdf.numPages);
                
                // Get the first page
                const page = await pdf.getPage(1);
                console.log('First page loaded');
                
                // Calculate scale for the canvas (target height: 300px)
                const viewport = page.getViewport({ scale: 1.0 });
                const scale = 300 / viewport.height;
                const scaledViewport = page.getViewport({ scale: scale });
                
                console.log('Calculated scale:', scale, 'Viewport size:', scaledViewport.width, 'x', scaledViewport.height);
                
                // Create canvas
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.height = scaledViewport.height;
                canvas.width = scaledViewport.width;
                canvas.style.maxWidth = '100%';
                canvas.style.height = 'auto';
                canvas.style.borderRadius = '8px';
                canvas.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.1)';
                
                console.log('Canvas created with dimensions:', canvas.width, 'x', canvas.height);
                
                // Render the page
                const renderContext = {
                    canvasContext: context,
                    viewport: scaledViewport
                };
                
                await page.render(renderContext).promise;
                console.log('PDF page rendered successfully');
                
                // Update the canvas container with the canvas
                if (canvasContainer) {
                    console.log('Updating canvas container with canvas');
                    canvasContainer.innerHTML = '';
                    canvasContainer.appendChild(canvas);
                    console.log('Canvas added to canvas container');
                } else {
                    console.error('canvasContainer not found!');
                }
                
            } catch (error) {
                console.error('Error generating PDF preview:', error);
                
                // Show error state
                if (canvasContainer) {
                    canvasContainer.innerHTML = `
                        <div style="background: white; border-radius: 16px; padding: 2rem; text-align: center; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); border: 3px solid #e5e7eb;">
                            <i class="fas fa-exclamation-triangle text-warning" style="font-size: 2rem;"></i>
                            <p style="color: #6b7280; margin-top: 1rem;">Could not generate preview</p>
                            <small style="color: #9ca3af;">PDF file loaded successfully</small>
                        </div>
                    `;
                }
            }
        }

        function removePdf() {
            console.log('Removing PDF');
            
            const pdfFile = document.getElementById('pdfFile');
            const uploadContent = document.getElementById('uploadContent');
            const previewContent = document.getElementById('pdfPreviewContent');
            
            if (pdfFile) pdfFile.value = '';
            if (uploadContent) uploadContent.style.display = 'block';
            if (previewContent) previewContent.style.display = 'none';
        }

        // Setup file uploads
        setupFileUpload('figure1File', 'figure1UploadArea', 'figure1FileInfo');
        setupFileUpload('figure2File', 'figure2UploadArea', 'figure2FileInfo');
        setupFileUpload('figure3File', 'figure3UploadArea', 'figure3FileInfo');
        setupFileUpload('figure4File', 'figure4UploadArea', 'figure4FileInfo');
        
        // Setup create button hover effect
        document.addEventListener('DOMContentLoaded', function() {
            const processBtn = document.getElementById('processBtn');
            if (processBtn) {
                processBtn.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-3px)';
                    this.style.boxShadow = 'var(--shadow-xl)';
                    const shine = this.querySelector('div');
                    if (shine) {
                        shine.style.left = '100%';
                    }
                });
                
                processBtn.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = 'var(--shadow-lg)';
                    const shine = this.querySelector('div');
                    if (shine) {
                        shine.style.left = '-100%';
                    }
                });
            }
        });
        


        // Load data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Delay loading initial data to ensure all functions are defined
            setTimeout(() => {
                loadInitialData();
                loadTemplateShowcase();
            }, 100);
            
            // Test PDF.js loading
            console.log('[DEBUG] Checking PDF.js library...');
            if (typeof pdfjsLib !== 'undefined') {
                console.log('[DEBUG] PDF.js library loaded successfully');
                console.log('[DEBUG] PDF.js version:', pdfjsLib.version);
            } else {
                console.error('[DEBUG] PDF.js library not loaded!');
            }

            // Simple PDF file upload setup
            const pdfFile = document.getElementById('pdfFile');
            if (pdfFile) {
                pdfFile.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file && file.type === 'application/pdf') {
                        showPdfPreview(file);
                    }
                });
            }

        });

        // FAQ Toggle Function
        function toggleFAQ(element) {
            const faqItem = element.parentElement;
            const answer = faqItem.querySelector('.faq-answer');
            const icon = element.querySelector('.faq-icon');
            
            // Close all other FAQ items
            const allFaqItems = document.querySelectorAll('.faq-item');
            allFaqItems.forEach(item => {
                if (item !== faqItem) {
                    const otherAnswer = item.querySelector('.faq-answer');
                    const otherIcon = item.querySelector('.faq-icon');
                    const otherQuestion = item.querySelector('.faq-question');
                    
                    otherAnswer.classList.remove('active');
                    otherIcon.textContent = '+';
                    otherQuestion.classList.remove('active');
                }
            });
            
            // Toggle current FAQ item
            const isActive = answer.classList.contains('active');
            
            if (isActive) {
                answer.classList.remove('active');
                icon.textContent = '+';
                element.classList.remove('active');
            } else {
                answer.classList.add('active');
                icon.textContent = '×';
                element.classList.add('active');
            }
        }

        // Join Waitlist Function
        function joinWaitlist() {
            // For now, redirect to the poster creation page as a fallback
            // In a real implementation, this would open a waitlist signup form
            alert('Thank you for your interest! We\'ll be launching soon. For now, you can try the tool by clicking "Get Early Access".');
            showPosterCreation();
        }

        // Load template showcase
        function loadTemplateShowcase() {
            fetch('/api/template-library')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.templates) {
                        populateTemplateShowcase(data.templates);
                    }
                })
                .catch(error => {
                    console.error('Error loading template showcase:', error);
                    // Fallback with sample templates
                    populateTemplateShowcase(getSampleTemplates());
                });
        }

        function populateTemplateShowcase(templates) {
            const scrollTrack = document.getElementById('templateScrollTrack');
            if (!scrollTrack) return;

            // Create template cards
            const templateCards = templates.map(template => {
                const badge = template.is_premium ? 'premium' : template.is_new ? 'new' : '';
                const badgeText = template.is_premium ? 'Premium' : template.is_new ? 'New' : '';
                
                // Check if template has preview
                const hasPreview = template.preview && template.preview !== '';
                const previewUrl = hasPreview ? `/api/template-library/preview/${template.preview}` : '/static/your-background-image.png';
                
                return `
                    <div class="template-preview-card">
                        ${badge ? `<div class="template-badge ${badge}">${badgeText}</div>` : ''}
                        <div class="template-preview-image">
                            ${hasPreview ? `<img src="${previewUrl}" alt="${template.name}">` : '<i class="fas fa-file-powerpoint placeholder-icon" style="font-size: 4rem; color: #6c757d;"></i>'}
                        </div>
                    </div>
                `;
            });

            // Duplicate templates for seamless scrolling
            const duplicatedTemplates = [...templateCards, ...templateCards];
            scrollTrack.innerHTML = duplicatedTemplates.join('');
        }

        function getSampleTemplates() {
            return [
                {
                    name: 'Modern Blue Template',
                    preview: null,
                    is_premium: false,
                    is_new: true
                },
                {
                    name: 'Classic Academic',
                    preview: null,
                    is_premium: false,
                    is_new: false
                },
                {
                    name: 'Research Pro',
                    preview: null,
                    is_premium: true,
                    is_new: false
                },
                {
                    name: 'Conference Ready',
                    preview: null,
                    is_premium: false,
                    is_new: false
                },
                {
                    name: 'Premium Scientific',
                    preview: null,
                    is_premium: true,
                    is_new: false
                },
                {
                    name: 'Clean Professional',
                    preview: null,
                    is_premium: false,
                    is_new: true
                }
            ];
        }

        // Page transition functions
        function showPosterCreation() {
            const landingPage = document.getElementById('landingPage');
            const posterCreationPage = document.getElementById('posterCreationPage');
            
            // Remove any transition classes first
            landingPage.classList.remove('page-transition', 'show', 'hide');
            posterCreationPage.classList.remove('page-transition', 'show', 'hide');
            
            // Add transition classes
            landingPage.classList.add('page-transition', 'hide');
            posterCreationPage.classList.add('page-transition');
            
            // Hide landing page and show poster creation page
            setTimeout(() => {
                landingPage.style.display = 'none';
                posterCreationPage.style.display = 'block';
                
                // Trigger the fade-in animation
                setTimeout(() => {
                    posterCreationPage.classList.add('show');
                }, 50);
            }, 300);
        }

        function showLandingPage() {
            const landingPage = document.getElementById('landingPage');
            const posterCreationPage = document.getElementById('posterCreationPage');
            
            // Remove any transition classes first
            posterCreationPage.classList.remove('page-transition', 'show', 'hide');
            landingPage.classList.remove('page-transition', 'show', 'hide');
            
            // Hide poster creation page and show landing page
            posterCreationPage.style.display = 'none';
            landingPage.style.display = 'block';
            
            // Add show class to landing page
            setTimeout(() => {
                landingPage.classList.add('show');
            }, 50);
        }

        // Mode toggle functionality
        const dummyDataToggle = document.getElementById('dummyDataToggle');
        
        dummyDataToggle.addEventListener('change', function() {
            const useDummyData = this.checked;
            
            fetch('/api/mode', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ use_dummy_data: useDummyData })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateToggleUI(useDummyData);
                    fetch('/api/dummy-data-status')
                        .then(response => response.json())
                        .then(dummyData => {
                            updateDummyDataStatus(dummyData);
                        });
                } else {
                    this.checked = !useDummyData;
                    showNotification('Failed to update mode: ' + data.error, 'error');
                }
            })
            .catch(error => {
                this.checked = !useDummyData;
                showNotification('Error updating mode: ' + error.message, 'error');
            });
        });

        function updateToggleUI(useDummyData) {
            dummyDataToggle.checked = useDummyData;
            const aiProviderSection = document.getElementById('aiProviderSection');
            if (useDummyData) {
                document.getElementById('modeDescription').textContent = 'Using saved dummy data for testing';
                document.getElementById('toggleLabel').textContent = 'Dummy Mode';
                document.getElementById('modeInfo').textContent = 'Dummy Mode: Uses saved data (free, fast testing)';
                document.getElementById('pdfUploadSection').style.display = 'none';
                document.getElementById('dummyModeNotice').style.display = 'block';
                document.getElementById('dummyDataStatus').style.display = 'block';
                document.getElementById('pdfFile').removeAttribute('required');
                document.getElementById('processBtnText').textContent = 'Create Poster (Dummy Data)';
                if (aiProviderSection) aiProviderSection.style.display = 'none';
            } else {
                // Get current provider info
                fetch('/api/provider')
                    .then(response => response.json())
                    .then(providerData => {
                        const providerNames = {
                            'openai': 'OpenAI (ChatGPT)',
                            'anthropic': 'Anthropic (Claude)'
                        };
                        const providerName = providerNames[providerData.provider] || 'AI API';
                        document.getElementById('modeDescription').textContent = `Using ${providerName} for fresh data extraction`;
                        document.getElementById('toggleLabel').textContent = 'API Mode';
                        document.getElementById('modeInfo').textContent = `API Mode: Calls ${providerName} for fresh results`;
                    })
                    .catch(() => {
                        document.getElementById('modeDescription').textContent = 'Using AI API for fresh data extraction';
                        document.getElementById('toggleLabel').textContent = 'API Mode';
                        document.getElementById('modeInfo').textContent = 'API Mode: Calls AI API for fresh results';
                    });
                document.getElementById('pdfUploadSection').style.display = 'block';
                document.getElementById('dummyModeNotice').style.display = 'none';
                document.getElementById('dummyDataStatus').style.display = 'none';
                document.getElementById('pdfFile').setAttribute('required', 'required');
                document.getElementById('processBtnText').textContent = 'Create Academic Poster';
                if (aiProviderSection) aiProviderSection.style.display = '';
            }
        }

        function updateDummyDataStatus(data) {
            const dummyDataInfo = document.getElementById('dummyDataInfo');
            
            if (data.available) {
                const timestamp = new Date(data.timestamp).toLocaleString();
                
                // Create brief overview with key fields
                let overview = '';
                if (data.preview.title) {
                    overview += `<strong>Title:</strong> ${data.preview.title.substring(0, 60)}${data.preview.title.length > 60 ? '...' : ''}<br>`;
                }
                if (data.preview.authors) {
                    overview += `<strong>Authors:</strong> ${data.preview.authors.substring(0, 50)}${data.preview.authors.length > 50 ? '...' : ''}<br>`;
                }
                if (data.preview.Introduction) {
                    overview += `<strong>Introduction:</strong> ${data.preview.Introduction.substring(0, 80)}${data.preview.Introduction.length > 80 ? '...' : ''}`;
                }

        // AI Provider toggle functionality
        function setupAIProviderToggle() {
            const openaiProvider = document.getElementById('openaiProvider');
            const anthropicProvider = document.getElementById('anthropicProvider');
            
            // Load current provider status
            fetch('/api/provider')
                .then(response => response.json())
                .then(data => {
                    updateProviderUI(data);
                })
                .catch(error => {
                    console.error('Error loading provider status:', error);
                    document.getElementById('providerStatus').textContent = 'Error loading status';
                });
            
            // Handle provider changes
            openaiProvider.addEventListener('change', function() {
                if (this.checked) {
                    setAIProvider('openai');
                }
            });
            
            anthropicProvider.addEventListener('change', function() {
                if (this.checked) {
                    setAIProvider('anthropic');
                }
            });
        }
        
        function setAIProvider(provider) {
            fetch('/api/provider', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ provider: provider })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateProviderUI(data);
                    showNotification(`Switched to ${data.message}`, 'success');
                } else {
                    // Revert the selection
                    if (provider === 'openai') {
                        document.getElementById('anthropicProvider').checked = true;
                    } else {
                        document.getElementById('openaiProvider').checked = true;
                    }
                    showNotification('Failed to switch provider: ' + data.error, 'error');
                }
            })
            .catch(error => {
                // Revert the selection
                if (provider === 'openai') {
                    document.getElementById('anthropicProvider').checked = true;
                } else {
                    document.getElementById('openaiProvider').checked = true;
                }
                showNotification('Error switching provider: ' + error.message, 'error');
            });
        }
        
        function updateProviderUI(data) {
            const providerStatus = document.getElementById('providerStatus');
            const providerInfo = document.getElementById('providerInfo');
            const openaiProvider = document.getElementById('openaiProvider');
            const anthropicProvider = document.getElementById('anthropicProvider');
            
            // Update status
            if (data.provider === 'openai') {
                providerStatus.textContent = 'Using ChatGPT';
                providerInfo.textContent = 'GPT-4o model for intelligent content extraction';
                openaiProvider.checked = true;
            } else if (data.provider === 'anthropic') {
                providerStatus.textContent = 'Using Claude';
                providerInfo.textContent = 'Claude 3.5 Sonnet model for intelligent content extraction';
                anthropicProvider.checked = true;
            }
            
            // Update provider availability
            if (data.available_providers) {
                if (!data.available_providers.openai.configured) {
                    openaiProvider.disabled = true;
                    openaiProvider.parentElement.classList.add('disabled');
                    openaiProvider.parentElement.title = 'OpenAI API key not configured';
                }
                
                if (!data.available_providers.anthropic.configured) {
                    anthropicProvider.disabled = true;
                    anthropicProvider.parentElement.classList.add('disabled');
                    anthropicProvider.parentElement.title = 'Anthropic API key not configured';
                }
            }
        }
                
                dummyDataInfo.innerHTML = `
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle me-2"></i>
                        <strong>Dummy data available</strong>
                        <small class="d-block text-muted mt-1">Created: ${timestamp}</small>
                        <div class="mt-2 small">
                            ${overview}
                        </div>
                    </div>
                `;
            } else {
                dummyDataInfo.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>No dummy data found</strong>
                        <small class="d-block">${data.message || data.error || 'Upload a PDF in API mode to create dummy data'}</small>
                    </div>
                `;
            }
        }

        // Template library management
        function updateTemplateLibrary(templates) {
            const templateGrid = document.getElementById('templateGrid');
            if (!templateGrid) {
                return;
            }
            templateGrid.innerHTML = '';
            

            
            // Add default template
            const defaultTemplate = document.createElement('div');
            defaultTemplate.className = 'template-card';
            if (selectedTemplateFilename === 'default') defaultTemplate.classList.add('selected');
            defaultTemplate.onclick = () => selectTemplate('default', 'Default Template', defaultTemplate);
            defaultTemplate.innerHTML = `
                <div class="checkmark"><i class="fas fa-check"></i></div>
                <div class="template-preview">
                    <i class="fas fa-file-powerpoint placeholder-icon"></i>
                    <div class="template-buttons">
                        <button type="button" class="preview-btn" onclick="event.stopPropagation(); openPreviewModal('/static/your-background-image.png', 'default')">
                            <i class="fas fa-eye me-1"></i>Preview
                        </button>
                    </div>
                </div>
            `;
            templateGrid.appendChild(defaultTemplate);

            // Sort templates: regular templates first, then premium, then coming soon
            const sortedTemplates = templates.sort((a, b) => {
                // Coming soon templates go last
                if (a.is_coming_soon && !b.is_coming_soon) return 1;
                if (!a.is_coming_soon && b.is_coming_soon) return -1;
                
                // Within each category, sort by name
                return a.name.localeCompare(b.name);
            });

            // Add other templates
            sortedTemplates.forEach(template => {
                const templateCard = document.createElement('div');
                templateCard.className = 'template-card';
                
                // Handle coming soon templates
                if (template.is_coming_soon) {
                    templateCard.classList.add('coming-soon');
                } else {
                    if (selectedTemplateFilename === template.filename) templateCard.classList.add('selected');
                    templateCard.onclick = () => selectTemplate(template.filename, template.name, templateCard);
                }
                
                // Add badges
                let badges = '';
                if (template.is_premium) {
                    badges += '<div class="premium-badge"><i class="fas fa-crown"></i><span class="premium-text"> Premium</span></div>';
                }
                if (template.is_new) {
                    badges += '<div class="new-badge"><i class="fas fa-star"></i> NEW</div>';
                }
                if (template.is_coming_soon) {
                    badges += '<div class="coming-soon-badge"><i class="fas fa-clock"></i> Coming Soon</div>';
                }
                
                // Check if template has preview
                const hasPreview = template.preview && template.preview !== '';
                const previewUrl = hasPreview ? `/api/template-library/preview/${template.preview}` : '/static/your-background-image.png';
                
                let previewHtml = `
                    <div class="checkmark"><i class="fas fa-check"></i></div>
                    ${badges}
                    <div class="template-preview">
                        ${hasPreview ? `<img src="${previewUrl}" alt="${template.name}">` : '<i class="fas fa-file-powerpoint placeholder-icon"></i>'}
                        <div class="template-buttons">
                            <button type="button" class="preview-btn" onclick="event.stopPropagation(); openPreviewModal('${previewUrl}', '${template.filename}')">
                                <i class="fas fa-eye me-1"></i>Preview
                            </button>
                        </div>
                    </div>
                `;
                
                templateCard.innerHTML = previewHtml;
                templateGrid.appendChild(templateCard);
            });
        }

        function selectTemplate(filename, name, cardElement) {
            selectedTemplateFilename = filename;
            document.getElementById('selectedTemplateInput').value = filename;
            
            // Remove selected from all cards
            document.querySelectorAll('.template-card').forEach(card => card.classList.remove('selected'));
            
            // Add selected to clicked card
            if (cardElement) {
                cardElement.classList.add('selected');
            }
            
            showNotification(`Selected template: ${name}`, 'success');
        }

        // Loading animation
        function showLoading() {
            const overlay = document.getElementById('loadingOverlay');
            if (!overlay) {
                console.error('Loading overlay not found!');
                return;
            }
            
            // Force scroll to top with multiple methods
            window.scrollTo(0, 0);
            document.documentElement.scrollTop = 0;
            document.body.scrollTop = 0;
            
            // Also scroll any scrollable containers
            const scrollableElements = document.querySelectorAll('.scrollable, [style*="overflow"]');
            scrollableElements.forEach(el => {
                if (el.scrollTop !== undefined) {
                    el.scrollTop = 0;
                }
            });
            
            console.log('Scrolled to top, current scroll position:', window.pageYOffset);
            
            // Show the overlay as a centered modal
            overlay.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Prevent background scroll
            
            // Force a reflow to ensure display: flex is applied
            overlay.offsetHeight;
            
            // Add show class for animation
            setTimeout(() => {
                overlay.classList.add('show');
            }, 10);
            
            // Double-check scroll position after a short delay
            setTimeout(() => {
                if (window.pageYOffset > 0) {
                    console.log('Still not at top, forcing scroll again...');
                    window.scrollTo(0, 0);
                    document.documentElement.scrollTop = 0;
                    document.body.scrollTop = 0;
                }
            }, 100);
            
            // Remove test indicator code - no longer needed
            
            // Reset progress and steps
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            if (progressBar) progressBar.style.width = '0%';
            if (progressText) progressText.textContent = '0%';
            currentStep = 0;
            
            // Reset all steps
            const steps = ['step1', 'step2', 'step3', 'step4', 'step5'];
            steps.forEach(stepId => {
                const step = document.getElementById(stepId);
                if (step) {
                    step.classList.remove('active', 'completed');
                    step.innerHTML = `
                        <i class="fas fa-${getStepIcon(stepId)}"></i>
                        <span>${getStepText(stepId)}</span>
                    `;
                }
            });
            
            // Activate first step
            const step1 = document.getElementById('step1');
            if (step1) step1.classList.add('active');
            
            // Hide both indicators first
            const aiIndicator = document.getElementById('aiProviderIndicator');
            const dummyIndicator = document.getElementById('dummyIndicator');
            if (aiIndicator) aiIndicator.style.display = 'none';
            if (dummyIndicator) dummyIndicator.style.display = 'none';
            
            // Show the correct indicator
            const isDummyMode = dummyDataToggle.checked;
            if (isDummyMode && dummyIndicator) {
                dummyIndicator.style.display = 'block';
            } else {
                showAIProviderIndicator();
            }
            
            updateLoadingStep();
            
            // Debug logging
            console.log('Loading modal should now be visible');
            console.log('Overlay display:', overlay.style.display);
            console.log('Overlay opacity:', overlay.style.opacity);
            console.log('Overlay z-index:', overlay.style.zIndex);
            
            // Check if content exists
            const content = overlay.querySelector('.loading-content');
            if (content) {
                console.log('Content found:', content);
                console.log('Content display:', content.style.display);
                console.log('Content opacity:', content.style.opacity);
            } else {
                console.error('Loading content not found!');
            }
        }
        
        function getStepIcon(stepId) {
            const icons = {
                'step1': 'file-pdf',
                'step2': 'brain',
                'step3': 'palette',
                'step4': 'image',
                'step5': 'check-circle'
            };
            return icons[stepId] || 'circle';
        }
        
        function getStepText(stepId) {
            const texts = {
                'step1': 'Extracting content from PDF...',
                'step2': 'Processing with AI...',
                'step3': 'Applying template styling...',
                'step4': 'Inserting figures...',
                'step5': 'Finalizing poster...'
            };
            return texts[stepId] || 'Processing...';
        }

        function updateLoadingStep() {
            const steps = ['step1', 'step2', 'step3', 'step4', 'step5'];
            const stepMessages = [
                'Extracting content from PDF...',
                'Processing with AI...',
                'Applying template styling...',
                'Inserting figures...',
                'Finalizing poster...'
            ];
            
            // Update current step
            if (currentStep < steps.length) {
                document.getElementById(steps[currentStep]).classList.add('active');
                document.getElementById('loadingSubtitle').textContent = stepMessages[currentStep];
            }
            
            // Update progress
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = Math.round(progress) + '%';
        }

        function completeLoadingStep() {
            const steps = ['step1', 'step2', 'step3', 'step4', 'step5'];
            if (currentStep < steps.length) {
                const currentStepElement = document.getElementById(steps[currentStep]);
                currentStepElement.classList.remove('active');
                currentStepElement.classList.add('completed');
                
                // Get the original text for this step
                const stepText = getStepText(steps[currentStep]);
                currentStepElement.innerHTML = `
                    <i class="fas fa-check-circle"></i>
                    <span>${stepText}</span>
                `;
            }
            currentStep++;
            updateLoadingStep();
        }

        function showAIProviderIndicator() {
            // Get current AI provider
            const openaiRadio = document.getElementById('openaiProvider');
            const anthropicRadio = document.getElementById('anthropicProvider');
            
            const indicator = document.getElementById('aiProviderIndicator');
            const providerName = document.getElementById('aiProviderName');
            const providerBadge = indicator.querySelector('.ai-provider-badge');
            
            // Determine which provider is selected
            let provider = 'openai';
            let providerDisplayName = 'ChatGPT (OpenAI)';
            
            if (anthropicRadio && anthropicRadio.checked) {
                provider = 'anthropic';
                providerDisplayName = 'Claude (Anthropic)';
            }
            
            // Update the indicator
            providerName.textContent = `Processing with ${providerDisplayName}...`;
            providerBadge.className = `ai-provider-badge ${provider}`;
            
            // Show the indicator
            indicator.style.display = 'block';
        }

        function updateAIProviderIndicator(aiProviderInfo) {
            const indicator = document.getElementById('aiProviderIndicator');
            const providerName = document.getElementById('aiProviderName');
            const providerBadge = indicator.querySelector('.ai-provider-badge');
            
            // Update with actual provider used
            providerName.textContent = `Processed with ${aiProviderInfo.display_name} (${aiProviderInfo.model})`;
            providerBadge.className = `ai-provider-badge ${aiProviderInfo.provider}`;
            
            // Show the indicator if not already visible
            indicator.style.display = 'block';
        }

        function hideLoading() {
            // Hide the loading modal with animation
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.classList.remove('show');
                setTimeout(() => {
                    overlay.style.display = 'none';
                }, 300); // Wait for animation to complete
            }
            document.body.style.overflow = '';
        }

        // Form submission
        document.getElementById('uploadForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            console.log('Form submitted - showing loading modal...');
            
            const formData = new FormData(this);
            const isDummyMode = dummyDataToggle.checked;
            
            // Add figure descriptions to form data
            const figureDescriptions = {};
            for (let i = 1; i <= 4; i++) {
                const descriptionInput = document.getElementById(`figure${i}Description`);
                if (descriptionInput && descriptionInput.value.trim()) {
                    // Strip the "Figure X: " prefix from the frontend since backend will add it
                    let description = descriptionInput.value.trim();
                    const prefix = `Figure ${i}: `;
                    if (description.startsWith(prefix)) {
                        description = description.substring(prefix.length);
                    }
                    
                    // Only add if there's actual content after stripping the prefix
                    if (description.trim()) {
                        figureDescriptions[i] = {
                            description: description.trim()
                        };
                    }
                }
            }
            
            // Add figure descriptions as JSON string
            if (Object.keys(figureDescriptions).length > 0) {
                formData.append('figure_descriptions', JSON.stringify(figureDescriptions));
            }
            
            // Add AI provider selection to form data
            const openaiRadio = document.getElementById('openaiProvider');
            const anthropicRadio = document.getElementById('anthropicProvider');
            let selectedProvider = 'openai'; // default
            
            if (anthropicRadio && anthropicRadio.checked) {
                selectedProvider = 'anthropic';
            }
            formData.append('ai_provider', selectedProvider);
            
            // Validate form
            if (!isDummyMode) {
                const pdfFile = document.getElementById('pdfFile').files[0];
                if (!pdfFile) {
                    showNotification('Please upload a PDF file for API mode.', 'error');
                    return;
                }
            }
            
            // Show loading
            showLoading();
            
            // Double-check modal is visible after a short delay
            setTimeout(() => {
                const overlay = document.getElementById('loadingOverlay');
                if (overlay && overlay.style.display !== 'flex') {
                    console.log('Modal not visible, forcing display...');
                    overlay.style.display = 'flex';
                    overlay.classList.add('show');
                }
            }, 100);
            
            // Send request
            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Update AI provider indicator with actual provider used (only if not in dummy mode)
                    const isDummyMode = dummyDataToggle.checked;
                    if (data.ai_provider && !isDummyMode) {
                        updateAIProviderIndicator(data.ai_provider);
                    }
                    
                    // Show extracted data preview after step 2 (AI processing)
                    setTimeout(() => {
                        showExtractedDataPreview(data.extracted_data);
                    }, 4000);
                    
                    // Complete all steps with proper timing - faster and more visible
                    setTimeout(() => completeLoadingStep(), 1500); // Step 1: PDF extraction
                    setTimeout(() => completeLoadingStep(), 3000); // Step 2: AI processing
                    setTimeout(() => completeLoadingStep(), 4500); // Step 3: Template styling
                    setTimeout(() => completeLoadingStep(), 6000); // Step 4: Figure insertion
                    setTimeout(() => {
                        completeLoadingStep(); // Step 5: Finalizing
                        
                        // Change spinner to checkmark
                        const spinner = document.querySelector('.loading-spinner');
                        spinner.classList.add('completed');
                        
                        // Show completion message
                        document.getElementById('loadingTitle').textContent = 'Poster Created Successfully!';
                        document.getElementById('loadingSubtitle').textContent = 'Your academic poster is ready for download';
                        
                        // Show download button
                        setTimeout(() => {
                            showDownloadButton(data.filename);
                        }, 1000);
                    }, 7500);
                } else {
                    hideLoading();
                    showNotification(data.error, 'error');
                }
            })
            .catch(error => {
                hideLoading();
                showNotification('An error occurred: ' + error.message, 'error');
            });
        });

        function showExtractedDataPreview(extractedData) {
            const previewDiv = document.getElementById('extractedDataPreview');
            const contentDiv = document.getElementById('extractedDataContent');
            const loadingContent = document.querySelector('.loading-content');
            const progressSection = document.getElementById('progressSection');
            
            // Create detailed overview with more content
            let overview = '';
            const keyFields = ['title', 'authors', 'Introduction'];
            
            keyFields.forEach(field => {
                if (extractedData[field]) {
                    const value = extractedData[field];
                    // Show more content - up to 300 characters for title, 200 for others
                    const maxLength = field === 'title' ? 300 : 200;
                    const truncatedValue = value.length > maxLength ? value.substring(0, maxLength) + '...' : value;
                    overview += `
                        <div class="mb-3 text-center">
                            <strong>${field.charAt(0).toUpperCase() + field.slice(1)}:</strong>
                            <div class="text-muted mt-1" style="font-size: 0.9rem; line-height: 1.4;">${truncatedValue}</div>
                        </div>
                    `;
                }
            });
            
            contentDiv.innerHTML = `
                <div class="alert alert-info text-center">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Content extracted successfully!</strong>
                    <div class="mt-3">
                        ${overview}
                    </div>
                </div>
            `;
            
            // Expand the modal and create two-column layout
            loadingContent.classList.add('expanded');
            
            // Create row container
            const rowContainer = document.createElement('div');
            rowContainer.className = 'row mt-4';
            
            // Move progress section to left column
            const leftColumn = document.createElement('div');
            leftColumn.className = 'col-md-4';
            leftColumn.appendChild(progressSection);
            
            // Create right column for preview
            const rightColumn = document.createElement('div');
            rightColumn.className = 'col-md-8';
            rightColumn.appendChild(previewDiv);
            
            // Add columns to row
            rowContainer.appendChild(leftColumn);
            rowContainer.appendChild(rightColumn);
            
            // Insert row after the title and subtitle
            const subtitle = document.getElementById('loadingSubtitle');
            subtitle.parentNode.insertBefore(rowContainer, subtitle.nextSibling);
            
            // Show the preview
            previewDiv.style.display = 'block';
        }

        function showDownloadButton(filename) {
            const loadingContent = document.querySelector('.loading-content');
            
            // Remove any existing download buttons
            const existingButtons = loadingContent.querySelector('.download-buttons');
            if (existingButtons) {
                existingButtons.remove();
            }
            
            // Create download button container
            const downloadBtnContainer = document.createElement('div');
            downloadBtnContainer.className = 'download-buttons mt-4 text-center';
            downloadBtnContainer.innerHTML = `
                <a href="/download/${filename}" class="btn btn-process">
                    <i class="fas fa-download me-2"></i>Download Poster (PowerPoint)
                </a>
                <button class="btn btn-outline-secondary ms-2 mt-3" onclick="startOver()">
                    <i class="fas fa-undo me-2"></i>Start Over
                </button>
            `;
            
            // Insert at the end of the loading content
            loadingContent.appendChild(downloadBtnContainer);
            
            // Keep the modal open for a bit longer so users can see the download options
            // The modal will stay visible until user clicks "Start Over" or downloads
        }

        function showResults(data) {
            // Populate extracted data
            const extractedDataDiv = document.getElementById('extractedData');
            extractedDataDiv.innerHTML = '<h5>Extracted Information:</h5>';
            
            for (const [key, value] of Object.entries(data.extracted_data)) {
                extractedDataDiv.innerHTML += `
                    <div class="alert alert-info mb-2">
                        <strong>${key.charAt(0).toUpperCase() + key.slice(1).replace(/_/g, ' ')}:</strong>
                        <div class="mt-1">${value}</div>
                    </div>
                `;
            }
            
            // Setup download link
            document.getElementById('downloadLink').href = `/download/${data.filename}`;
            
            // Show results modal
            document.getElementById('resultsModal').style.display = 'flex';
        }

        function showNotification(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            const alertClass = type === 'success' ? 'alert-success' : 
                              type === 'error' ? 'alert-danger' : 'alert-warning';
            const icon = type === 'success' ? 'check-circle' : 
                        type === 'error' ? 'exclamation-circle' : 'exclamation-triangle';
            
            const notification = document.createElement('div');
            notification.className = `alert ${alertClass} alert-dismissible fade show`;
            notification.innerHTML = `
                <i class="fas fa-${icon} me-2"></i>${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            alertContainer.appendChild(notification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }



        // Close modals when clicking outside
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay')) {
                e.target.style.display = 'none';
            }
            if (e.target.classList.contains('preview-modal')) {
                closePreviewModal();
            }
        });

        // Global variables for preview functionality
        let previewedTemplateFilename = null;

        // Preview Modal Functions
        function openPreviewModal(imageUrl, templateFilename = null) {
            document.getElementById('previewImage').src = imageUrl;
            const modal = document.getElementById('previewModal');
            modal.style.display = 'block';
            
            // Scroll the modal into view
            modal.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            previewedTemplateFilename = templateFilename;
            
            // Load template description if we have a template filename
            if (templateFilename && templateFilename !== 'default') {
                loadTemplateDescription(templateFilename);
            } else {
                // Show default message for the default template
                document.getElementById('previewTemplateTitle').innerHTML = '<i class="fas fa-eye"></i>Default Template Preview';
                document.getElementById('templateDescription').innerHTML = `
                    <h6><i class="fas fa-star"></i>Default Template</h6>
                    <p>A clean, professional template with a modern blue color scheme that works perfectly for any type of presentation.</p>
                    
                    <h6><i class="fas fa-check-circle"></i>Choose this template if:</h6>
                    <ul>
                        <li>You want a simple, clean design</li>
                        <li>You prefer traditional professional layouts</li>
                        <li>You need a template that works with any content</li>
                        <li>You want something professional but not flashy</li>
                    </ul>
                    
                    <div class="ideal-for">
                        <strong>Perfect for:</strong> Professional presentations, research showcases, and general business use.
                    </div>
                `;
            }
        }

        function loadTemplateDescription(templateFilename) {
            // Extract template name from filename (remove .pptx extension)
            const templateName = templateFilename.replace('.pptx', '');
            
            // Update the modal title
            document.getElementById('previewTemplateTitle').innerHTML = `<i class="fas fa-eye"></i>${templateName} Preview`;
            
            // Fetch template description from API
            fetch(`/api/template-descriptions/${encodeURIComponent(templateName)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.description) {
                        const desc = data.description;
                        document.getElementById('templateDescription').innerHTML = `
                            <h6><i class="fas fa-palette"></i>${desc.title}</h6>
                            <p>${desc.description}</p>
                            
                            <h6><i class="fas fa-check-circle"></i>Choose this template if:</h6>
                            <ul>
                                ${desc.choose_if.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                            
                            <div class="ideal-for">
                                <strong>Ideal for:</strong> ${desc.ideal_for}
                            </div>
                        `;
                    } else {
                        // Fallback if no description found
                        document.getElementById('templateDescription').innerHTML = `
                            <h6><i class="fas fa-file-powerpoint"></i>${templateName}</h6>
                            <p>A professional template designed for your presentation needs with modern styling and clean layout.</p>
                            
                            <h6><i class="fas fa-check-circle"></i>Features:</h6>
                            <ul>
                                <li>Professional design</li>
                                <li>Clean layout</li>
                                <li>Modern styling</li>
                                <li>Easy to customize</li>
                            </ul>
                            
                            <div class="ideal-for">
                                <strong>Perfect for:</strong> Professional presentations and business showcases.
                            </div>
                        `;
                    }
                })
                .catch(error => {
                    console.error('Error loading template description:', error);
                    document.getElementById('templateDescription').innerHTML = `
                        <h6><i class="fas fa-file-powerpoint"></i>${templateName}</h6>
                        <p>A professional template designed for your presentation needs with modern styling and clean layout.</p>
                        
                        <h6><i class="fas fa-check-circle"></i>Features:</h6>
                        <ul>
                            <li>Professional design</li>
                            <li>Clean layout</li>
                            <li>Modern styling</li>
                            <li>Easy to customize</li>
                        </ul>
                        
                        <div class="ideal-for">
                            <strong>Perfect for:</strong> Professional presentations and business showcases.
                        </div>
                    `;
                });
        }

        function closePreviewModal() {
            document.getElementById('previewModal').style.display = 'none';
            previewedTemplateFilename = null;
            
            // Reset the description to loading state
            document.getElementById('templateDescription').innerHTML = `
                <div class="text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2 text-muted">Loading template details...</p>
                </div>
            `;
        }

        function selectTemplateFromPreview() {
            if (!previewedTemplateFilename) {
                closePreviewModal();
                return;
            }
            
            // Find the card that corresponds to the currently previewed template
            const templateCards = document.querySelectorAll('.template-card');
            let targetCard = null;
            
            for (let card of templateCards) {
                const previewBtn = card.querySelector('.preview-btn');
                if (previewBtn && previewBtn.onclick && previewBtn.onclick.toString().includes(previewedTemplateFilename)) {
                    targetCard = card;
                    break;
                }
            }
            
            // Select the template
            selectTemplate(previewedTemplateFilename, '', targetCard);
            closePreviewModal();
        }

        // Setup preview modal click outside to close
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('previewModal');
            const modalContent = document.querySelector('.preview-modal-content');
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closePreviewModal();
                }
            });
            
            // Prevent clicks inside modal content from closing the modal
            modalContent.addEventListener('click', function(e) {
                e.stopPropagation();
            });
        });

        // Add event listeners for full screen buttons
        function setupFigureFullscreenButtons() {
            document.querySelectorAll('.figure-fullscreen-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const figureNum = this.getAttribute('data-figure');
                    const img = document.getElementById(`figure${figureNum}PreviewImg`);
                    const descInput = document.getElementById(`figure${figureNum}Description`);
                    const overlay = document.getElementById('figurePopoverOverlay');
                    const popover = document.getElementById('figurePopoverContent');
                    const popImg = document.getElementById('figurePopoverImg');
                    const popDesc = document.getElementById('figurePopoverDescription');

                    // Set image and description
                    popImg.src = img.src;
                    popDesc.value = descInput.value;
                    popDesc.setAttribute('data-figure', figureNum);

                    // Position the popover near the clicked button
                    const rect = this.getBoundingClientRect();
                    const scrollY = window.scrollY || window.pageYOffset;
                    const scrollX = window.scrollX || window.pageXOffset;
                    // Place popover below the button, but keep in viewport
                    let top = rect.bottom + scrollY + 10;
                    let left = rect.left + scrollX - 100;
                    if (left < 10) left = 10;
                    if (left + 600 > window.innerWidth) left = window.innerWidth - 620;
                    if (top + 350 > window.innerHeight + scrollY) top = window.innerHeight + scrollY - 370;
                    popover.style.top = top + 'px';
                    popover.style.left = left + 'px';

                    overlay.style.display = 'block';
                    document.body.style.overflow = 'hidden';
                });
            });

            // Close popover on close button
            document.getElementById('closeFigurePopover').onclick = function() {
                document.getElementById('figurePopoverOverlay').style.display = 'none';
                document.body.style.overflow = '';
            };
            // Close popover when clicking outside
            document.getElementById('figurePopoverOverlay').onclick = function(e) {
                if (e.target === this) {
                    this.style.display = 'none';
                    document.body.style.overflow = '';
                }
            };
            // Sync popover textarea with main form
            document.getElementById('figurePopoverDescription').oninput = function() {
                const figureNum = this.getAttribute('data-figure');
                const mainDesc = document.getElementById(`figure${figureNum}Description`);
                if (mainDesc) {
                    mainDesc.value = this.value;
                    mainDesc.dispatchEvent(new Event('input'));
                }
            };
        }

        // Simple popup logic
        function showFigurePopup(figureNum, imgSrc, description, event) {
          console.log('showFigurePopup called for figure', figureNum);
          const popup = document.getElementById('figurePopup');
          const img = document.getElementById('figurePopupImg');
          const desc = document.getElementById('figurePopupDescription');
          
          if (!popup) {
            console.error('Popup not found!');
            return;
          }
          
          img.src = imgSrc;
          desc.value = description || '';
          desc.setAttribute('data-figure', figureNum);
          
          // Position popup near the click
          const rect = event.target.getBoundingClientRect();
          let left = rect.left + window.scrollX;
          let top = rect.top + window.scrollY - 50;
          const popupWidth = 500;
          const popupHeight = 400;
          // Prevent off right edge
          if (left + popupWidth > window.innerWidth + window.scrollX) {
            left = window.innerWidth + window.scrollX - popupWidth - 20;
          }
          // Prevent off top
          if (top < 20 + window.scrollY) {
            top = 20 + window.scrollY;
          }
          popup.style.left = left + 'px';
          popup.style.top = top + 'px';
          popup.style.display = 'block';
          console.log('Popup should now be visible');
          console.log('Popup position:', popup.style.left, popup.style.top);
          console.log('Popup display:', popup.style.display);
          console.log('Popup element:', popup);
        }

        document.getElementById('closeFigurePopup').onclick = function() {
          const popup = document.getElementById('figurePopup');
          const desc = document.getElementById('figurePopupDescription');
          const figureNum = desc.getAttribute('data-figure');
          const mainDesc = document.getElementById(`figure${figureNum}Description`);
          if (mainDesc) {
            mainDesc.value = desc.value;
            mainDesc.dispatchEvent(new Event('input'));
          }
          popup.style.display = 'none';
        };

        // Figure description text areas with automatic figure name prepending
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Setting up figure description text areas...');
            for (let i = 1; i <= 4; i++) {
                const textarea = document.getElementById(`figure${i}Description`);
                if (textarea) {
                    console.log(`Figure ${i} textarea found:`, textarea);
                    
                    // Add focus event to handle placeholder behavior
                    textarea.addEventListener('focus', function() {
                        console.log(`Figure ${i} textarea focused`);
                        // If the textarea is empty or only contains the placeholder, clear it
                        if (this.value === '' || this.value === `Figure ${i}: `) {
                            this.value = `Figure ${i}: `;
                            // Position cursor after "Figure X: "
                            this.setSelectionRange(this.value.length, this.value.length);
                        }
                    });
                    
                    // Add blur event to ensure figure name is always present
                    textarea.addEventListener('blur', function() {
                        if (this.value.trim() === '' || this.value.trim() === `Figure ${i}:`) {
                            this.value = '';
                        } else if (!this.value.startsWith(`Figure ${i}: `)) {
                            // If user deleted the prefix, add it back
                            this.value = `Figure ${i}: ${this.value}`;
                        }
                    });
                    
                    // Add input event to prevent deletion of the prefix
                    textarea.addEventListener('input', function(e) {
                        console.log(`Figure ${i} textarea input:`, this.value);
                        
                        // If user tries to delete the "Figure X: " prefix, prevent it
                        if (!this.value.startsWith(`Figure ${i}: `)) {
                            // Restore the prefix
                            const userText = this.value.replace(`Figure ${i}: `, '').replace(`Figure ${i}:`, '');
                            this.value = `Figure ${i}: ${userText}`;
                            
                            // Position cursor at the end
                            this.setSelectionRange(this.value.length, this.value.length);
                        }
                    });
                    
                    // Add keydown event to handle backspace at the beginning
                    textarea.addEventListener('keydown', function(e) {
                        const prefix = `Figure ${i}: `;
                        const cursorPos = this.selectionStart;
                        
                        // If user presses backspace and cursor is at or before the prefix
                        if (e.key === 'Backspace' && cursorPos <= prefix.length) {
                            e.preventDefault(); // Prevent deletion of prefix
                        }
                    });
                    
                    // Set initial placeholder
                    textarea.placeholder = `Enter a description for Figure ${i}...`;
                    
                } else {
                    console.error(`Figure ${i} textarea NOT found!`);
                }
            }
        });

        // Full-size image modal functionality
        function showFullSizeImage(imageSrc, fileName) {
            // Create modal if it doesn't exist
            let modal = document.getElementById('fullSizeImageModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'fullSizeImageModal';
                modal.innerHTML = `
                    <div class="full-size-modal-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 9999; display: flex; align-items: center; justify-content: center;" onclick="closeFullSizeImage()">
                        <div class="full-size-modal-content" style="max-width: 50%; max-height: 50%; position: relative;" onclick="event.stopPropagation()">
                            <button class="full-size-modal-close" onclick="closeFullSizeImage()" style="position: absolute; top: -40px; right: 0; background: none; border: none; color: white; font-size: 24px; cursor: pointer; z-index: 10000;">
                                <i class="fas fa-times"></i>
                            </button>
                            <img src="${imageSrc}" alt="${fileName}" style="max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 8px;">
                            <div style="position: absolute; bottom: -30px; left: 0; color: white; font-size: 14px;">
                                ${fileName}
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            } else {
                // Update existing modal
                const img = modal.querySelector('img');
                const fileNameDiv = modal.querySelector('div');
                if (img) img.src = imageSrc;
                if (fileNameDiv) fileNameDiv.textContent = fileName;
            }
            
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Prevent scrolling
        }

        function closeFullSizeImage() {
            const modal = document.getElementById('fullSizeImageModal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = ''; // Restore scrolling
            }
        }

        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeFullSizeImage();
            }
        });


    </script>
</body>
</html> 